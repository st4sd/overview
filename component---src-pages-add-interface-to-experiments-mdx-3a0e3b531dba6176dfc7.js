"use strict";(self.webpackChunkst4sd_overview=self.webpackChunkst4sd_overview||[]).push([[7155],{9161:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return s},default:function(){return h}});var a=t(45),r=(t(6540),t(5680)),i=t(8027);const o=["components"],s={},p=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.yg)("div",n)},l=p("PageDescription"),u=p("InlineNotification"),m=p("AnchorLinks"),y=p("AnchorLink"),c={_frontmatter:s},g=i.A;function h(e){let{components:n}=e,t=(0,a.A)(e,o);return(0,r.yg)(g,Object.assign({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)(l,{mdxType:"PageDescription"},(0,r.yg)("p",null,"This page assumes you are familiar with writing basic experiments and running them locally using the elaunch.py command line tool. If you need a refresher take a moment to read our ",(0,r.yg)("a",{parentName:"p",href:"/overview/write-experiments"},"docs")," before continuing any further.")),(0,r.yg)(u,{kind:"info",mdxType:"InlineNotification"},(0,r.yg)("p",null,"Here, we are using DSL 2.0, if you need to understand the previous syntax check out the ",(0,r.yg)("a",{parentName:"p",href:"/overview/workflow-specification"},"FlowIR docs")," and ",(0,r.yg)("a",{parentName:"p",href:"/overview/tutorial"},"FlowIR tutorial"),".")),(0,r.yg)(m,{mdxType:"AnchorLinks"},(0,r.yg)(y,{mdxType:"AnchorLink"},"Requirements"),(0,r.yg)(y,{mdxType:"AnchorLink"},"An experiment that has key-outputs"),(0,r.yg)(y,{mdxType:"AnchorLink"},"An experiment that has an interface")),(0,r.yg)("h3",null,"Requirements"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"An understanding of ",(0,r.yg)("a",{parentName:"p",href:"/overview/direct-run"},"how to run a ST4SD workflow locally"),".")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"An understanding of ",(0,r.yg)("a",{parentName:"p",href:"/overview/write-experiments"},"how to write a basic ST4SD workflow"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"A python 3.9+ interpreter")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"A virtual environment with the ",(0,r.yg)("inlineCode",{parentName:"p"},"st4sd-runtime-core")," python module"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'python -m venv venv\n. ./venv/bin/activate\npip install "st4sd-runtime-core[develop]>=2.5.1"\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"A local copy of ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/st4sd/st4sd-examples"},"https://github.com/st4sd/st4sd-examples")),(0,r.yg)("p",{parentName:"li"},"  Clone the github repository and then cd into its sub-directory ",(0,r.yg)("inlineCode",{parentName:"p"},"tutorials/2-experiments-with-interface")),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/st4sd/st4sd-examples.git\n")))),(0,r.yg)("h2",null,"An experiment that has key-outputs"),(0,r.yg)("p",null,"All experiments produce files, but not all generated files are equally important. To this end ST4SD has the concept of key-outputs. These are files, and directories, that an experiment produces which the developers of the experiment consider important."),(0,r.yg)(u,{kind:"info",mdxType:"InlineNotification"},(0,r.yg)("p",null,"Make sure your working directory is the sub-directory ",(0,r.yg)("inlineCode",{parentName:"p"},"tutorials/2-experiments-with-interface")," of the directory you stored ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/st4sd/st4sd-examples"},"https://github.com/st4sd/st4sd-examples")," in.")),(0,r.yg)("p",null,"Here is a an example of an experiment with a key-output:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'entrypoint:\n  entry-instance: hello\n  execute:\n  - target: <entry-instance>\n    args:\n      message: Hello world\n  output:\n    - name: greeting\n      data-in: <entry-instance>:output\n      description: just a friendly greeting\n\ncomponents:\n- signature:\n    name: hello\n    parameters:\n      - name: message\n  command:\n    executable: echo\n    arguments: "%(message)s"\n\n')),(0,r.yg)("p",null,"File: ",(0,r.yg)("inlineCode",{parentName:"p"},"0-key-outputs.yaml")),(0,r.yg)("p",null,"Run it like so:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-commandline"},"elaunch.py -l40 --nostamp 0-key-outputs.yaml\n")),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"output")," field in the ",(0,r.yg)("inlineCode",{parentName:"p"},"entrypoint")," dictionary defines the key-outputs of this experiment:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"entrypoint:\n  # ... other fields ...\n  output:\n    - name: greeting\n      data-in: <entry-instance>:output\n")),(0,r.yg)("p",null,"This experiment has a single key-output called ",(0,r.yg)("inlineCode",{parentName:"p"},"greeting"),". The data associated with this key-output is actually the ",(0,r.yg)("inlineCode",{parentName:"p"},"stdout")," of the ",(0,r.yg)("inlineCode",{parentName:"p"},"<entry-instance>")," step which is an instance of the ",(0,r.yg)("inlineCode",{parentName:"p"},"hello")," component. As the experiment finishes producing this key-output the ",(0,r.yg)("inlineCode",{parentName:"p"},"$INSTANCE_DIR/output/output.json")," file is updated to reflect the state of this experiment."),(0,r.yg)("p",null,"Here’s an example of ",(0,r.yg)("inlineCode",{parentName:"p"},"output.json"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "greeting": {\n        "creationtime": "1725374555.6836693",\n        "description": "just a friendly greeting",\n        "filename": "out.stdout",\n        "filepath": "stages/stage0/entry-instance/out.stdout",\n        "final": "yes",\n        "production": "yes",\n        "type": "",\n        "version": "1"\n    }\n}\n')),(0,r.yg)("p",null,"While the experiment is running, the runtime system asynchronously updates this file with metadata about the generated key-outputs of the experiment. In this example, there is just one key-output called ",(0,r.yg)("inlineCode",{parentName:"p"},"greeting"),". For more information on key-outputs check out our ",(0,r.yg)("a",{parentName:"p",href:"/overview/workflow-specification#key-outputs"},"documentation"),"."),(0,r.yg)("p",null,"If you are running experiments on the cloud and are instructing the runtime system to register them into the ST4SD datastore you may also use the ST4SD python API to ",(0,r.yg)("a",{parentName:"p",href:"/overview/running-workflows-on-openshift#retrieving-the-outputs-of-a-virtual-experiment-instance"},"download")," the key-outputs of your experiment instances."),(0,r.yg)("h3",null,"Exercises"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Use ",(0,r.yg)("inlineCode",{parentName:"li"},"elaunch.py")," to run ",(0,r.yg)("inlineCode",{parentName:"li"},"0-key-outputs.yaml")," and look at the file containing the key-output metadata."),(0,r.yg)("li",{parentName:"ul"},"Write a new experiment that has a single component called nested inside a workflow. See the example on ",(0,r.yg)("a",{parentName:"li",href:"/overview/write-more-experiments#your-first-multi-step-experiment"},"nested workflows")," to refresh your memory on how to write experiments that contain both Workflow and Component templates. Add a key-output which points to the stdout of your component (use an ",(0,r.yg)("a",{parentName:"li",href:"/overview/workflow-specification-dsl#outputreference"},"OutputReference")," that points to the ",(0,r.yg)("inlineCode",{parentName:"li"},":output")," of your component’s instance).")),(0,r.yg)("h2",null,"An experiment that has an interface"),(0,r.yg)("p",null,"Some virtual experiments define interfaces which make it simpler for users to retrieve the input systems and measured properties from executions of that virtual experiment."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"interface")," of a virtual experiment defines:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"The specification used to describe ",(0,r.yg)("inlineCode",{parentName:"li"},"input")," systems it processes e.g. SMILEs for small molecules"),(0,r.yg)("li",{parentName:"ul"},"Instructions to extract the ",(0,r.yg)("inlineCode",{parentName:"li"},"input")," systems from input data"),(0,r.yg)("li",{parentName:"ul"},"Instructions to extract the values of ",(0,r.yg)("inlineCode",{parentName:"li"},"properties")," that the virtual experiment computes")),(0,r.yg)("p",null,"Once a virtual experiment has an ",(0,r.yg)("inlineCode",{parentName:"p"},"interface"),"  ST4SD can return a ",(0,r.yg)("inlineCode",{parentName:"p"},"pandas.DataFrame"),"  containing the properties calculated by instances of the virtual experiment, as well as the ids of the ",(0,r.yg)("inlineCode",{parentName:"p"},"input")," systems that an instance processed. This functionality is provided via the ",(0,r.yg)("inlineCode",{parentName:"p"},"st4sd-datastore")," API and the ",(0,r.yg)("inlineCode",{parentName:"p"},"st4sd-runtime-service")," API. See ",(0,r.yg)("a",{parentName:"p",href:"/overview/using-a-virtual-experiment-interface"},"using a virtual experiment interface")," for further information."),(0,r.yg)("p",null,"In this example we will work with a virtual experiment which:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"extracts the IDs of its input systems"),(0,r.yg)("li",{parentName:"ol"},"has 2 key-outputs that correspond to 2 measured properties of the interface"),(0,r.yg)("li",{parentName:"ol"},"uses builtin hooks to extract the measured properties from the key-outputs")),(0,r.yg)("p",null,"The DSL of the experiment is :"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'entrypoint:\n  interface:\n    description: Counts vowels in words\n    inputSpec:\n      namingScheme: words\n      inputExtractionMethod:\n        csvColumn:\n          source:\n            path: input/words.csv\n          args:\n            column: word\n    propertiesSpec:\n    - name: Vowels\n      propertyExtractionMethod:\n        csvDataFrame:\n          source:\n            keyOutput: vowels\n          args:\n            renameColumns:\n              word: input-id\n            usecols:\n            - word\n            - vowels\n    - name: Letters\n      propertyExtractionMethod:\n        csvDataFrame:\n          source:\n            keyOutput: letters\n          args:\n            renameColumns:\n              word: input-id\n            usecols:\n            - word\n            - letters\n  output:\n    - name: vowels\n      data-in: <entry-instance/count-vowels>/vowels.csv:ref\n    - name: letters\n      data-in: <entry-instance/count-letters>/letters.csv:ref\n\n  entry-instance: main\n  execute:\n    - target: <entry-instance>\n      args:\n        words_file: input/words.csv:ref\n\nworkflows:\n  - signature:\n      name: main\n      parameters:\n        - name: words_file\n    steps:\n      count-vowels: count-vowels\n      count-letters: count-letters\n    execute:\n      - target: <count-vowels>\n        args:\n          words: "%(words_file)s"\n      - target: <count-letters>\n        args:\n          words: "%(words_file)s"\n\ncomponents:\n- signature:\n    name: count-vowels\n    parameters:\n    - name: words\n  command:\n    executable: bin/count_vowels.py\n    arguments: "%(words)s"\n\n- signature:\n    name: count-letters\n    parameters:\n      - name: words\n  command:\n    executable: bin/count_letters.py\n    arguments: "%(words)s"\n')),(0,r.yg)("p",null,"File: ",(0,r.yg)("inlineCode",{parentName:"p"},"1-interface.package/conf/dsl.yaml")),(0,r.yg)("p",null,"The interface contains a human readable description of the experiment under ",(0,r.yg)("inlineCode",{parentName:"p"},"entrypoint.interface.description"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"entrypoint:\n  interface:\n    description: Counts vowels in words\n")),(0,r.yg)("p",null,"Then, in ",(0,r.yg)("inlineCode",{parentName:"p"},"entrypoint.interface.inputspec")," it uses the builtin input extraction method ",(0,r.yg)("inlineCode",{parentName:"p"},"csvColumn")," to extract the ids of the systems it processes:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"entrypoint:\n  interface:\n    inputSpec:\n      namingScheme: words\n      inputExtractionMethod:\n        csvColumn:\n          source:\n            path: input/words.csv\n          args:\n            column: word\n")),(0,r.yg)("p",null,"It instructs the method to read the CSV file ",(0,r.yg)("inlineCode",{parentName:"p"},"input/words.csv")," (i.e. the input file) and treat every row of the CSV as one input system whose identifier lies in the column ",(0,r.yg)("inlineCode",{parentName:"p"},"word"),"."),(0,r.yg)("p",null,"Following that, it uses the builtin property extraction method ",(0,r.yg)("inlineCode",{parentName:"p"},"csvDataFrame")," twice to measure its 2 properties ",(0,r.yg)("inlineCode",{parentName:"p"},"Vowels")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Letters")," from the key-outputs ",(0,r.yg)("inlineCode",{parentName:"p"},"vowels")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"letters")," respectively."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"entrypoint:\n  interface:\n    propertiesSpec:\n    - name: Vowels\n      propertyExtractionMethod:\n        csvDataFrame:\n          source:\n            keyOutput: vowels\n          args:\n            renameColumns:\n              word: input-id\n            usecols:\n            - word\n            - vowels\n    - name: Letters\n      propertyExtractionMethod:\n        csvDataFrame:\n          source:\n            keyOutput: letters\n          args:\n            renameColumns:\n              word: input-id\n            usecols:\n            - word\n            - letters\n")),(0,r.yg)("p",null,"The ",(0,r.yg)("a",{parentName:"p",href:"/overview/writing-a-virtual-experiment-interface#csvdataframe"},(0,r.yg)("inlineCode",{parentName:"a"},"csvDataFrame"))," property extraction method expects a CSV file which has the columns ",(0,r.yg)("inlineCode",{parentName:"p"},"input-id")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"${the property name}"),". One of the requirements for using a ST4SD interface is that the property names start with a capital letter. One of the requirements of the ",(0,r.yg)("inlineCode",{parentName:"p"},"csvDataFrame")," is that there should be a column with the same name as the property name that is being extracted. Another is that there should be a column called ",(0,r.yg)("inlineCode",{parentName:"p"},"input-id"),"."),(0,r.yg)("p",null,"In this example the components happen to produce key-output CSV files which contain a properly named column for the values of properties but instead of using the ",(0,r.yg)("inlineCode",{parentName:"p"},"input-id")," column they use the column ",(0,r.yg)("inlineCode",{parentName:"p"},"word"),". To account for this inconsistency, the developers of the workflow use the ",(0,r.yg)("inlineCode",{parentName:"p"},"renameColumns")," argument of the ",(0,r.yg)("inlineCode",{parentName:"p"},"csvDataFrame")," property extraction method. Via ",(0,r.yg)("inlineCode",{parentName:"p"},"renameColumns")," they instruct ",(0,r.yg)("inlineCode",{parentName:"p"},"csvDataFrame")," to treat the column ",(0,r.yg)("inlineCode",{parentName:"p"},"word")," as if it were called ",(0,r.yg)("inlineCode",{parentName:"p"},"input-id"),"."),(0,r.yg)("p",null,"Notice that the entrypoint expects an input file called ",(0,r.yg)("inlineCode",{parentName:"p"},"words.csv"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},"entrypoint:\n    ...\n    execute:\n    - target: <entry-instance>\n      args:\n        words_file: input/words.csv:ref\n")),(0,r.yg)("p",null,"This means that you have to create a CSV file called ",(0,r.yg)("inlineCode",{parentName:"p"},"words.csv")," and use it as an input for (via the ",(0,r.yg)("inlineCode",{parentName:"p"},"-i")," arg) to the workflow."),(0,r.yg)("p",null,"To run this experiment, you can copy/paste the following to your terminal:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},": create the input file\ncat<<EOF >words.csv\nword;\nhello;\nawesome;\nworld;\nEOF\n\n: launch the experiment\nelaunch.py -l 20 -i words.csv 1-interface.package\n")),(0,r.yg)("p",null,"If you are running experiments on the cloud and are instructing the runtime system to register them into the ST4SD datastore you may also use the ST4SD python API to ",(0,r.yg)("a",{parentName:"p",href:"/overview/using-a-virtual-experiment-interface#getting-the-properties"},"download")," the measured properties of your experiment instances."),(0,r.yg)("h2",null,"Exercises"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Use ",(0,r.yg)("inlineCode",{parentName:"li"},"elaunch.py")," to run ",(0,r.yg)("inlineCode",{parentName:"li"},"1-interface.package"),". Then look at the files:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"$INSTANCE_DIR/output/output.json")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"$INSTANCE_DIR/output/input-ids.json")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"$INSTANCE_DIR/output/properties.csv")))),(0,r.yg)("li",{parentName:"ul"},"Update the experiment to use a custom python hook for extracting the measured properties from the key-outputs. The documentation for the ",(0,r.yg)("inlineCode",{parentName:"li"},"hookGetProperties")," hook is ",(0,r.yg)("a",{parentName:"li",href:"/overview/writing-a-virtual-experiment-interface#hookgetproperties"},"here"),".")),(0,r.yg)("h2",null,"What’s next?"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"More information on running experiments directly, i.e. via ",(0,r.yg)("inlineCode",{parentName:"li"},"elaunch.py")," ",(0,r.yg)("a",{parentName:"li",href:"https://st4sd.github.io/overview/direct-run"},"here")),(0,r.yg)("li",{parentName:"ul"},"More information on the DSL of ST4SD i.e. how to write experiments ",(0,r.yg)("a",{parentName:"li",href:"https://st4sd.github.io/overview/workflow-specification-dsl"},"here")),(0,r.yg)("li",{parentName:"ul"},"More information on how to structure and test your experiments ",(0,r.yg)("a",{parentName:"li",href:"https://st4sd.github.io/overview/packaging-workflows/"},"here")),(0,r.yg)("li",{parentName:"ul"},"More information on writing experiments with interfaces ",(0,r.yg)("a",{parentName:"li",href:"/overview/writing-a-virtual-experiment-interface"},"here"))))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-add-interface-to-experiments-mdx-3a0e3b531dba6176dfc7.js.map
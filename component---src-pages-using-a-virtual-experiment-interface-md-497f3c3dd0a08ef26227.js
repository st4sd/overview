"use strict";(self.webpackChunkst4sd_overview=self.webpackChunkst4sd_overview||[]).push([[449],{8742:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return s},default:function(){return h}});var a=n(3366),i=(n(7294),n(4983)),r=n(1217),p=["components"],s={},o=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)}},l=o("PageDescription"),c=o("AnchorLinks"),u=o("AnchorLink"),d=o("InlineNotification"),m={_frontmatter:s},f=r.Z;function h(e){var t=e.components,n=(0,a.Z)(e,p);return(0,i.kt)(f,Object.assign({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)(l,{mdxType:"PageDescription"},(0,i.kt)("p",null,"Learn how to use a virtual experiment interface")),(0,i.kt)(c,{mdxType:"AnchorLinks"},(0,i.kt)(u,{mdxType:"AnchorLink"},"Checking if a Virtual Experiment has an interface"),(0,i.kt)(u,{mdxType:"AnchorLink"},"Accessing Interface Metadata"),(0,i.kt)(u,{mdxType:"AnchorLink"},"Getting the Properties"),(0,i.kt)(u,{mdxType:"AnchorLink"},"Handling errors")),(0,i.kt)("p",null,"Some virtual experiments define interfaces which make it simpler for users to retrieve the inputs systems and measured properties from executions of that virtual experiment"),(0,i.kt)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",(0,i.kt)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"24.305555555555557%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5UlEQVQY022MW4+CMBhE+f//cJWokSJIv7aUSy8iPRvD02Y9yZl5mqnia0es497cUQ9F1/e0D0XTKvr+wSQDzgpaBhYrLM4wG80smnkaCSkQYjg6BaoSAt469CAYMTjreD6f9H2PHgbm0TN5j7OWxU+EeSGt62GM5Jz/WFEKr5ww1mCtRWvN7XZDRGiahkYp2rZFKcW5rhFj+FD4TvWJlBLee7qu4/Rzoq5rlmWhPp+5Xq+EEIgxcrlccM4dy/L9strLTn5l8nboZ48YIaaIHS1udMQciTkhVljDyru82faNbX//8xdgWn9cVV2vSAAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,i.kt)("picture",{parentName:"span"},"\n          ",(0,i.kt)("source",{parentName:"picture",srcSet:["/overview/static/6936b4930be3ffe936bf8db07fec9efc/0eda2/image-20220915212832988.webp 288w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/460e2/image-20220915212832988.webp 576w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/e0ca3/image-20220915212832988.webp 1152w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/d02be/image-20220915212832988.webp 1728w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/28e18/image-20220915212832988.webp 2218w"],sizes:"(max-width: 1152px) 100vw, 1152px",type:"image/webp"}),"\n          ",(0,i.kt)("source",{parentName:"picture",srcSet:["/overview/static/6936b4930be3ffe936bf8db07fec9efc/7fc1e/image-20220915212832988.png 288w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/a5df1/image-20220915212832988.png 576w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/3cbba/image-20220915212832988.png 1152w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/0b124/image-20220915212832988.png 1728w","/overview/static/6936b4930be3ffe936bf8db07fec9efc/0c220/image-20220915212832988.png 2218w"],sizes:"(max-width: 1152px) 100vw, 1152px",type:"image/png"}),"\n          ",(0,i.kt)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/overview/static/6936b4930be3ffe936bf8db07fec9efc/3cbba/image-20220915212832988.png",alt:"image-20220915212832988",title:"image-20220915212832988",loading:"lazy",decoding:"async",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"}}),"\n        "),"\n    "),(0,i.kt)("h2",null,"Checking if a Virtual Experiment has an interface"),(0,i.kt)(c,{small:!0,mdxType:"AnchorLinks"},(0,i.kt)(u,{mdxType:"AnchorLink"},"Check the global registry"),(0,i.kt)(u,{mdxType:"AnchorLink"},"Check your local registry from a iPython notebook"),(0,i.kt)(u,{mdxType:"AnchorLink"},"Check the return value of api_rest_uid_status")),(0,i.kt)(d,{mdxType:"InlineNotification"},(0,i.kt)("p",null,"Check the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/st4sd/st4sd-examples/blob/main/notebooks/ST4SD%20Runtime%20API%20Property%20Retrieval.ipynb"},"accompanying python notebook")," for examples of all the features and code described here .")),(0,i.kt)("h3",null,"Check the global registry"),(0,i.kt)("p",null,"If you got the virtual experiment package from the ",(0,i.kt)("a",{parentName:"p",href:"https://registry.st4sd.res.ibm.com/"},"global registry"),", go to the global registry entry and check if it has a ",(0,i.kt)("em",{parentName:"p"},"Virtual Experiment Interface")," section."),(0,i.kt)("h3",null,"Check your local registry from a iPython notebook"),(0,i.kt)("p",null,"If you know the id of the virtual experiment package execute the following - it will print ",(0,i.kt)("inlineCode",{parentName:"p"},"True")," if the experiment has an ",(0,i.kt)("inlineCode",{parentName:"p"},"interface"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"package = api.api_experiment_get('toxicity-prediction-nb')\nif package['metadata']['registry']['interface']:\n    print(True)\n")),(0,i.kt)("h3",null,"Check the return value of ",(0,i.kt)("inlineCode",{parentName:"h3"},"api_rest_uid_status")),(0,i.kt)("p",null,"If youâ€™ve launched a run of a virtual experiment you can check runs status document to see if it has an interface. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"status = api.api_rest_uid_status(rest_uid)\nif status['experiment']['metadata']['registry']['interface']:\n    print(True)\n")),(0,i.kt)(d,{mdxType:"InlineNotification"},(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"status['experiment']")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"package")," above have the same schema. The difference is that ",(0,i.kt)("inlineCode",{parentName:"p"},"status['experiment']")," contains additional information that ST4SD discovers after it executes the instructions in the ",(0,i.kt)("inlineCode",{parentName:"p"},"package"),". For example, the input-ids that the virtual experiment processed (in ",(0,i.kt)("inlineCode",{parentName:"p"},"experiment.metadata.registry.interface.inputs"),").")),(0,i.kt)("h2",null,"Accessing Interface Metadata"),(0,i.kt)("p",null,"When you run a virtual experiment with an ",(0,i.kt)("inlineCode",{parentName:"p"},"interface")," there are two ways to retrieve it using the instances ",(0,i.kt)("inlineCode",{parentName:"p"},"rest_uid")," - both return the same data."),(0,i.kt)("p",null,"The interface contains a description of the virtual experiment along with information on the inputs, the input spec and the names of the properties measured by the virtual experiment"),(0,i.kt)("h4",null,"Using the st4sd-runtime-service API"),(0,i.kt)("p",null,"From the instances status ",(0,i.kt)("inlineCode",{parentName:"p"},"json")," e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"status = api.api_rest_uid_status(rest_uid)\nprint(status['experiment']['metadata']['registry']['interface'])\n")),(0,i.kt)("h4",null,"Using the st4sd-datastore API"),(0,i.kt)("p",null,"From the instances experiment document e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"exp_doc = api.cdb_get_document_experiment_for_rest_uid(\n        rest_uid,\n        include_properties=['*'])\nprint(exp_doc['interface'])\n")),(0,i.kt)(d,{mdxType:"InlineNotification"},(0,i.kt)("p",null,"The method ",(0,i.kt)("inlineCode",{parentName:"p"},"api.cdb_get_document_experiment_for_rest_uid()")," raises an exception if the virtual experiment has not produced properties.")),(0,i.kt)("h2",null,"Getting the Inputs"),(0,i.kt)("p",null,"The list of input system ids are available in the ",(0,i.kt)("inlineCode",{parentName:"p"},"status")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"experiment")," documents by default"),(0,i.kt)("h4",null,"Using the st4sd-runtime-service API"),(0,i.kt)("p",null,"The inputs are stored at ",(0,i.kt)("inlineCode",{parentName:"p"},"['experiment']['metadata']['registry']['interface']['inputs']")," in the instances status ",(0,i.kt)("inlineCode",{parentName:"p"},"json"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"print(status['experiment']['metadata']['registry']['interface']['inputs'])\n")),(0,i.kt)("h4",null,"Using the st4sd-datastore API"),(0,i.kt)("p",null,"The inputs are stored at ",(0,i.kt)("inlineCode",{parentName:"p"},"['interface']['inputs']")," in the instances experiment document e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"print(exp_doc['interface']['inputs'])\n")),(0,i.kt)("h2",null,"Getting the Properties"),(0,i.kt)("p",null,"The property-table of a virtual experiment run can be obtained in a number of ways. In all cases the property-table is returned as a ",(0,i.kt)("inlineCode",{parentName:"p"},"dict")," that can be used to instantiate a ",(0,i.kt)("inlineCode",{parentName:"p"},"pandas.DataFrame"),"."),(0,i.kt)("h4",null,"Using the st4sd-runtime-service API"),(0,i.kt)("p",null,"There are two options"),(0,i.kt)("h5",null,"Option One: With instance status"),(0,i.kt)("p",null,"Add the ",(0,i.kt)("inlineCode",{parentName:"p"},"include_properties")," keyword parameter to the ",(0,i.kt)("inlineCode",{parentName:"p"},"api_rest_uid_status")," call. Its value should be one of"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"['*']")," if you want all the properties"),(0,i.kt)("li",{parentName:"ul"},"A list of valid property-names (as defined in the interface) if you want a selection")),(0,i.kt)("p",null,"The property table is then available at the key-path ",(0,i.kt)("inlineCode",{parentName:"p"},"status['experiment']['metadata']['registry']['interface']['propertyTable']")," e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"status = api.api_rest_uid_status(rest_uid, include_properties=['*'])\ninterface = status['experiment']['metadata']['registry']['interface']\ndf = pandas.DataFrame.from_dict(interface['propertyTable'])\ndf\n")),(0,i.kt)("h5",null,"Option Two: Direct REST-API call"),(0,i.kt)("p",null,"You can make a direct request to get the full property table using the ",(0,i.kt)("inlineCode",{parentName:"p"},"instances/{restUID}/properties")," route e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"properties_dict = api.api_request_get(f'instances/{restUID}/properties')\ndf = pd.DataFrame.from_dict(properties_dict)\ndf\n")),(0,i.kt)("p",null,"You can also select properties using ",(0,i.kt)("inlineCode",{parentName:"p"},"includeProperties")," as a query parameter to the route e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"instances/{restUID}/properties?includeProperties=$VALUE"),"where $VALUE is a comma separated list of property names"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"properties_dict  = api.api_request_get(f'instances/{restUID}/properties?includeProperties=logp')\ndf = pd.DataFrame.from_dict(properties_dict )\ndf\n")),(0,i.kt)("h4",null,"Using the st4sd-datastore API"),(0,i.kt)("p",null,"Add the ",(0,i.kt)("inlineCode",{parentName:"p"},"include_properties")," keyword parameter to the ",(0,i.kt)("inlineCode",{parentName:"p"},"cdb_get_document_experiment_for_rest_uid")," call. Its value should one of"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"['*']")," if you want all the properties"),(0,i.kt)("li",{parentName:"ul"},"A list of valid property-names (as defined in the interface) if you want a selection")),(0,i.kt)("p",null,"The property table is then available at the key-path ",(0,i.kt)("inlineCode",{parentName:"p"},"exp_doc['interface']['propertyTable']")," e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"exp_doc = api.cdb_get_document_experiment_for_rest_uid(\n        rest_uid,\n        include_properties=['*'])\ndf = pandas.DataFrame.from_dict(exp_doc['interface']['propertyTable'])\ndf\n")),(0,i.kt)("h2",null,"Handling Errors"),(0,i.kt)(d,{kind:"warning",mdxType:"InlineNotification"}," Asking for properties before the experiment instance has produced them returns a HTTP status code 400. Asking for properties which do not exist returns a HTTP status code 404. "),(0,i.kt)("p",null,"Below is an example of handling errors from requests for properties:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"import experiment.service.db.errors\nimport experiment.service.db\nimport pandas.DataFrame\n\n# After the virtual experiment instance terminates\ntry:\n    # Here we request all ('*') properties that the `rest_uid` instance measured\n    status = api.api_rest_uid_status(rest_uid, include_properties=['*'])\n    df: pandas.DataFrame = pandas.DataFrame.from_dict(\n        status['experiment']['interface']['propertyTable'])\nexcept experiment.errors.InvalidHttpRequest as e:\n    print(\"Got invalid HTTP status code\", e.response.status_code)\n    error_info = e.response.json()\n    if 'unknownRestUID' in error_info:\n        print(\"There is no such rest-uid\")\n    elif 'propertiesNotAvailableYet' in error_info:\n        print(\"Experiment has not produced properties yet - try again later\")\n    elif 'unknownProperties' in error_info):\n        print(f\"Experiment has no properties: {error_info['unknownProperties']}\")\n    else:\n        print(f\"Unknown HTTP problem {e}\")\n        raise\n")))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-using-a-virtual-experiment-interface-md-497f3c3dd0a08ef26227.js.map
"use strict";(self.webpackChunkst4sd_overview=self.webpackChunkst4sd_overview||[]).push([[4216],{2138:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return u},default:function(){return w}});var a=n(45),i=(n(6540),n(5680)),r=n(8027),o=n(786),s=n(4689),p=n(1550);const l=["components"],u={},m=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.yg)("div",t)},g=m("PageDescription"),d=m("AnchorLinks"),c=m("AnchorLink"),y=m("InlineNotification"),h=m("ExpressiveList"),f={_frontmatter:u},x=r.A;function w(e){let{components:t}=e,n=(0,a.A)(e,l);return(0,i.yg)(x,Object.assign({},f,n,{components:t,mdxType:"MDXLayout"}),(0,i.yg)(g,{mdxType:"PageDescription"},(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py")," command line tool executes and monitors virtual experiments. You can use it to run experiments on your laptop or on a High Performance Computing Cluster. When you submit a virtual experiment via ST4SD API it is executed by ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py"),".")),(0,i.yg)(d,{mdxType:"AnchorLinks"},(0,i.yg)(c,{mdxType:"AnchorLink"},"Running experiments with elaunch.py"),(0,i.yg)(c,{mdxType:"AnchorLink"},"Providing the inputs to the experiment"),(0,i.yg)(c,{mdxType:"AnchorLink"},"Checking if your experiment worked"),(0,i.yg)(c,{mdxType:"AnchorLink"},"What is the output of my experiment ?"),(0,i.yg)(c,{mdxType:"AnchorLink"},"Troubleshooting")),(0,i.yg)("h2",null,"Install elaunch.py"),(0,i.yg)("p",null,"If you haven’t already, install the ",(0,i.yg)("inlineCode",{parentName:"p"},"st4sd-runtime-core")," python package:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},'pip install "st4sd-runtime-core[develop]">=2.4.0\n')),(0,i.yg)("h2",null,"Running experiments with elaunch.py"),(0,i.yg)("p",null,"Use elaunch.py to run virtual experiments: ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py <path to experiment>"),"."),(0,i.yg)("p",null,"Note, running experiments locally requires using either Linux or MacOS.\nWindows users should either use a Virtual Machine (e.g. ",(0,i.yg)("a",{parentName:"p",href:"https://www.virtualbox.org"},"VirtualBox")," etc) or the Windows Subsystem for Linux (",(0,i.yg)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows/wsl/install"},"WSL"),")."),(0,i.yg)("p",null,"Some experiments, like the below example, also require you to install one of ",(0,i.yg)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/"},"docker"),", ",(0,i.yg)("a",{parentName:"p",href:"https://podman.io/docs/installation"},"podman"),", or ",(0,i.yg)("a",{parentName:"p",href:"https://docs.rancherdesktop.io/getting-started/installation/"},"Rancher Desktop")," too."),(0,i.yg)("p",null,"For example, you can run the workflow ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/st4sd/nanopore-geometry-experiment"},(0,i.yg)("inlineCode",{parentName:"a"},"nanopore-geometry-experiment"))," like so:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},': # Get the directory containing the virtual experiment and cd into it\ngit clone https://github.com/st4sd/nanopore-geometry-experiment.git\ncd nanopore-geometry-experiment\n\n: # Run elaunch.py specifying certain files in the directory created above\nelaunch.py -i docker-example/cif_files.dat -l 40 --nostamp\\\n      --applicationDependencySource="nanopore-database=cif:copy" \\\n      nanopore-geometry-experiment.package\n')),(0,i.yg)("p",null,"The experiment should take about 5 minutes to complete. The ",(0,i.yg)("inlineCode",{parentName:"p"},"-l 40")," option keeps the log printouts to the bare minimum so don’t worry if the command is silent for a few minutes. When the experiment completes expect to see something similar to the following text on your terminal:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"completed-on=2024-03-15 14:39:29.909105\ncost=0\ncreated-on=2024-03-15 14:38:04.402969\ncurrent-stage=stage3\nexit-status=Success\nexperiment-state=finished\nstage-progress=1.0\nstage-state=finished\nstages=['stage0', 'stage1', 'stage2', 'stage3']\ntotal-progress=1.0\nupdated=2024-03-15 14:39:33.804727\nupdated-on=2024-03-15 14:39:33.804727\n")),(0,i.yg)(y,{kind:"info",mdxType:"InlineNotification"},(0,i.yg)("p",null,"If you run the same command a second time elaunch.py will complain that the experiment instance already exists. Either remove the ",(0,i.yg)("inlineCode",{parentName:"p"},"--nostamp")," argument or delete the directory and retry ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py"),". See Section ",(0,i.yg)("a",{parentName:"p",href:"#what-is-the-output-of-my-experiment"},"What is the output of my experiment?")," for more information.")),(0,i.yg)("h2",null,"Providing the inputs to the experiment"),(0,i.yg)("p",null,"The experiment requires two types of inputs:\nthe ",(0,i.yg)("strong",{parentName:"p"},"cif_files.dat")," input file, which contains a list of filenames, and\nthe ",(0,i.yg)("strong",{parentName:"p"},"nanopore-database")," application dependency, a directory containing the files listed in ",(0,i.yg)("strong",{parentName:"p"},"cif_files.dat"),"."),(0,i.yg)("p",null,"Note that application dependencies are directories located in the root of the virtual experiment instance. These directories are populated by the runtime system using the ",(0,i.yg)("inlineCode",{parentName:"p"},"--applicationDependencySource=$appDepName:/path/to/source")," command-line argument in ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py"),"."),(0,i.yg)("p",null,"For more details, refer to the ",(0,i.yg)("a",{parentName:"p",href:"/overview/workflow-specification#application-dependencies"},"application-dependencies documentation"),"."),(0,i.yg)("h2",null,"Checking if your experiment worked"),(0,i.yg)("p",null,"If the experiment works ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py")," prints ",(0,i.yg)("inlineCode",{parentName:"p"},"exit-status=Success")," before it terminates and then exits with return code 0. You can find more information about the status of your experiment under the file ",(0,i.yg)("inlineCode",{parentName:"p"},"${package_name}-${timestamp}.instance/output/status.txt"),". For example, here’s a ",(0,i.yg)("inlineCode",{parentName:"p"},"status.txt")," for a successful run of an experiment:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"completed-on=2025-03-21 13:15:19.790371\ncost=0\ncreated-on=2025-03-21 13:14:30.088069\ncurrent-stage=stage2\nexit-status=Success\nexperiment-state=finished\nstage-progress=1.0\nstage-state=finished\nstages=['stage0', 'stage1', 'stage2']\ntotal-progress=1.0\nupdated=2025-03-21 13:15:19.799143\nupdated-on=2025-03-21 13:15:19.799143\n")),(0,i.yg)("p",null,"If the experiment fails you will see the line ",(0,i.yg)("inlineCode",{parentName:"p"},"exit-status=Failed")," in the logs of ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py")," and it will exit with a return code other than ",(0,i.yg)("inlineCode",{parentName:"p"},"0"),". If the experiment failed after the instance directory was created you will see this information in the ",(0,i.yg)("inlineCode",{parentName:"p"},"output/status.txt")," file too. Common reasons for failures are invalid syntax, missing input files, or requesting a compute resource that is not available. For more information and dealing with these errors see our ",(0,i.yg)("a",{parentName:"p",href:"#troubleshooting"},"Troubleshooting")," section."),(0,i.yg)("h2",null,"What is the output of my experiment ?"),(0,i.yg)("p",null,"Looking inside the instance directory created for the experiment, we see the following:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"ls -lth nanopore-geometry-experiment.instance\ntotal 64\ndrwxrwxr-x@ 10 user  wheel   320B 21 Mar 13:15 output/\n-rw-r--r--@  1 user  wheel    28K 21 Mar 13:15 status.db\n-rw-rw-r--@  1 user  wheel   536B 21 Mar 13:14 elaunch.yaml\ndrwxr-xr-x@  5 user  wheel   160B 21 Mar 13:14 hooks/\ndrwxrwxr-x@  5 user  wheel   160B 21 Mar 13:14 stages/\ndrwxr-xr-x@  5 user  wheel   160B 21 Mar 13:14 conf/\nlrwxrwxr-x@  1 user  wheel    31B 21 Mar 13:14 python@ -> /Users/user/venvs/st4sd\ndrwxrwxr-x@  3 user  wheel    96B 21 Mar 13:14 input/\ndrwxr-xr-x@  4 user  wheel   128B 21 Mar 13:03 nanopore-database/\n")),(0,i.yg)("p",null,"In order of importance:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"output"),": This directory contains metadata about the key outputs of the experiment as well as the measured properties of the input systems the experiment processed. You can find more information about the contents of this directory in our detailed ",(0,i.yg)("a",{parentName:"li",href:"/overview/direct-run-advanced#the-output-directory"},"breakdown of the output directory"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"stages"),": This directory holds all the working directories of all the steps that were executed during this experiment instance"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"input"),": The input files and variable parameterisation files we provided to the ",(0,i.yg)("inlineCode",{parentName:"li"},"elaunch.py")," command earlier"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"nanopore-database"),": This is an application-dependency that the experiment for reading information about the nanoporous materials it simulates"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"conf"),": The experiment definition"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"hooks"),": This contains code used to produce the interface properties. In general, it may also contain code that checks whether tasks finished successfully or not, however then ",(0,i.yg)("inlineCode",{parentName:"li"},"nanopore-geometry-experiment")," does not use this feature."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"python"),": A link to the virtual environment that was used during the execution of the experiment"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"elaunch.yaml"),": A YAML file containing metadata about the execution of the experiment"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"status.db"),": A SQLITE database containing metadata about execution of the experiment")),(0,i.yg)("h3",null,"Key outputs"),(0,i.yg)("p",null,"All experiments produce files, but not all generated files are equally important. To this end ST4SD has the concept of key-outputs. These are files, and directories, that an experiment produces which the developers of the experiment consider important."),(0,i.yg)("p",null,"The file ",(0,i.yg)("inlineCode",{parentName:"p"},"$instanceDirectory/output/output.json")," contains metadata about the key outputs of the experiment. Here’s how tha file looks like for the experiment we just ran:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},'{\n    "geometricalProperties": {\n        "creationtime": "1742562196.4740903",\n        "description": "",\n        "filename": "geometry.tgz",\n        "filepath": "stages/stage2/AggregateGeometry/geometry.tgz",\n        "final": "yes",\n        "production": "yes",\n        "type": "",\n        "version": "1"\n    }\n}\n')),(0,i.yg)("p",null,"The experiment generates a single key output, ",(0,i.yg)("strong",{parentName:"p"},"geometricalProperties"),", which is a tar file named ",(0,i.yg)("inlineCode",{parentName:"p"},"geometry.tgz"),". This file is created by the ",(0,i.yg)("inlineCode",{parentName:"p"},"stage2.AggregateGeometry")," step."),(0,i.yg)("h3",null,"Measured properties"),(0,i.yg)("p",null,"Key outputs are not always immediately parseable without deep understanding of their format. To address this, ST4SD supports the ",(0,i.yg)("strong",{parentName:"p"},"interface")," feature. This feature allows workflow developers to extract measured properties and store them in a CSV file, making the data easier to consume."),(0,i.yg)("p",null,"Experiments that implement an ",(0,i.yg)("inlineCode",{parentName:"p"},"interface")," will produce a file under ",(0,i.yg)("inlineCode",{parentName:"p"},"${instance-directory}/output/properties.csv"),". Here is the file that the ",(0,i.yg)("inlineCode",{parentName:"p"},"nanopore-geometry-experiment")," produced above:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"input-id;d_is;d_fs;d_isfs;asa_m^2/cm^3;asa_m^2/g;nasa_m^2/cm^3;nasa_m^2/g;unitcell_volume;density;av_volume_fraction;av_cm^3/g;nav_volume_fraction;nav_cm^3/g;n_pockets\nCoRE2019/GUJVOX_clean;3.98106;2.74095;3.93078;0.0;0.0;760.654;564.703;1164.59;1.347;0.0;0.0;0.016015;0.0118894;1.0\n")),(0,i.yg)("p",null,"The CSV file will always contain the ",(0,i.yg)("inlineCode",{parentName:"p"},"input-id")," column. Its values are the identifiers of the input system ids for which the virtual experiment measured properties. The remaining columns contain the measured properties for the input systems."),(0,i.yg)("h2",null,"Troubleshooting"),(0,i.yg)("h3",null,"Unable to create instance directory at specified location Error"),(0,i.yg)("p",null,"If you run the same command a second time elaunch.py will complain that the experiment instance already exists:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"completed-on=N/A\ncost=0\ncreated-on=N/A\ncurrent-stage=None\nerror-description=ExperimentSetupError Error encountered while setting up experiment.\\\\nPackage validation failed - cannot deploy\\\\nUnderlying error: Unable to create instance directory at specified location.\\\\nUnderlying error: [Errno 17] File exists: '/private/tmp/test/nanopore-geometry-experiment/nanopore-geometry-experiment/nanopore-geometry-experiment/nanopore-geometry-experiment.instance'\nexit-status=Failed\nexperiment-state=failed\nstage-progress=0\nstage-state=Initialising\nstages=[]\ntotal-progress=0\nupdated=2025-03-21 13:25:21.950382\nupdated-on=2025-03-21 13:25:21.950382\n")),(0,i.yg)("p",null,"To fix this problem, either remove the ",(0,i.yg)("inlineCode",{parentName:"p"},"--nostamp")," argument or delete the directory and retry ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py"),"."),(0,i.yg)("h3",null,"Investigating a Failed experiment"),(0,i.yg)("p",null,"If the ",(0,i.yg)("inlineCode",{parentName:"p"},"exit-status")," of your experiment instance is ",(0,i.yg)("inlineCode",{parentName:"p"},"Failed")," then this means that at least one of your components was unable to terminate successfully. You can find the name of the component that caused the experiment to fail in the ",(0,i.yg)("inlineCode",{parentName:"p"},"status")," file and printout."),(0,i.yg)("p",null,"Here is an example:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"completed-on=2024-05-23 09:44:03.757679\ncost=0\ncreated-on=2024-05-23 09:42:19.223491\ncurrent-stage=stage1\nerror-description=Stage 1 failed. Reason:\\\\\\\\n3 jobs failed unexpectedly.\\\\\\\\nJob: stage1.PartialSum0. Returncode 1. Reason KnownIssue\\\\\\\\nJob: stage1.PartialSum2. Returncode 1. Reason KnownIssue\\\\\\\\nJob: stage1.PartialSum1. Returncode 1. Reason KnownIssue\\\\\\\\n\nexit-status=Failed\nexperiment-state=finished\nstage-progress=0.5\nstage-state=failed\nstages=['stage0', 'stage1', 'stage2', 'stage3']\ntotal-progress=0.875\nupdated=2024-05-23 09:44:08.793316\nupdated-on=2024-05-23 09:44:08.793316\n")),(0,i.yg)("p",null,"The error reports that multiple components failed: ",(0,i.yg)("inlineCode",{parentName:"p"},"stage1.PartialSum0"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"stage1.PartialSum1"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"stage1.PartialSum2"),"."),(0,i.yg)("p",null,"You may also get a full view of the state of the experiment by using the ",(0,i.yg)("inlineCode",{parentName:"p"},"einspect.py -f all")," tool."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"========== STAGE 0 ==========\n\nComponents using engine-type: engine\nreference, state, backend, isWaitingOnOutput, engineExitReason, lastTaskRunTime, lastTaskRunState\nstage0.GenerateInput, finished, local, True, Success, 0:00:00.358677, finished\n\n========== STAGE 1 ==========\n\nComponents using engine-type: engine\nreference, state, backend, isWaitingOnOutput, engineExitReason, lastTaskRunTime, lastTaskRunState\nstage1.ExtractRow0, finished, local, True, Success, 0:01:00.246955, finished\nstage1.ExtractRow1, finished, local, True, Success, 0:01:00.209115, finished\nstage1.ExtractRow2, finished, local, True, Success, 0:01:00.226946, finished\nstage1.PartialSum0, failed, local, True, KnownIssue, 0:00:00.323739, failed\nstage1.PartialSum1, failed, local, True, KnownIssue, 0:00:00.336899, failed\nstage1.PartialSum2, failed, local, True, KnownIssue, 0:00:00.360914, failed\n\n========== STAGE 2 ==========\n\nComponents using engine-type: engine\nreference, state, backend, isWaitingOnOutput, engineExitReason, lastTaskRunTime, lastTaskRunState\nstage2.Sum, component_shutdown, local, False, Killed, N/A, N/A\n\n========== STAGE 3 ==========\n\nComponents using engine-type: engine\nreference, state, backend, isWaitingOnOutput, engineExitReason, lastTaskRunTime, lastTaskRunState\nstage3.Cat, finished, local, True, Success, 0:00:00.011466, finished\n")),(0,i.yg)("p",null,"After you spot a ",(0,i.yg)("inlineCode",{parentName:"p"},"Failed")," component, try looking at the files it produced, including its stdout and stderr (for some backends both streams get fed into stdout). Recall that you can find these files under ",(0,i.yg)("inlineCode",{parentName:"p"},"$INSTANCE_DIR/stages/stage<stage index>/<component name>/"),". Look for the ",(0,i.yg)("inlineCode",{parentName:"p"},"out.stdout")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"out.stderr")," files."),(0,i.yg)("p",null,"Sometimes, a component fails because one of its predecessors (direct, or indirect) produced unexpected output. To find the predecessors of a component, look at the ",(0,i.yg)("inlineCode",{parentName:"p"},"$INSTANCE_DIR/conf/flowir_instance.yaml"),", locate the component you are investigating and then follow its predecessors by looking at the ",(0,i.yg)("inlineCode",{parentName:"p"},"references")," of the component. You can then investigate the output files and stdout/stderr of those components to see if you can spot why the downstream component failed."),(0,i.yg)("h2",null,"The experiment outputs"),(0,i.yg)("h2",null,"Learn more"),(0,i.yg)("div",{className:"expressive-content-list-group"},(0,i.yg)(h,{title:"Write experiments",background:"true",pictogram:(0,i.yg)(s.zxw,{mdxType:"FileBackup"}),mdxType:"ExpressiveList"},(0,i.yg)("p",null,"Get an introduction to ",(0,i.yg)("a",{parentName:"p",href:"/overview/write-experiments"},"writing virtual experiment")," with ST4SD Core.")),(0,i.yg)(h,{title:"Advanced usage of elaunch.py",background:"true",pictogram:(0,i.yg)(p.S0q,{mdxType:"Tools"}),mdxType:"ExpressiveList"},(0,i.yg)("p",null,"This example only scratches the surface of how you can use elaunch.py. See ",(0,i.yg)("a",{parentName:"p",href:"/overview/direct-run-advanced"},"elaunch.py for advanced users")," for more information about using ",(0,i.yg)("inlineCode",{parentName:"p"},"elaunch.py")," including running on High Performance Computing clusters.")),(0,i.yg)(h,{title:"Exploring the Registry UI",background:"true",pictogram:(0,i.yg)(o.LCQ,{mdxType:"CarbonForIbmDotcom"}),mdxType:"ExpressiveList"},(0,i.yg)("p",null,"Learn about all the features of\n",(0,i.yg)("a",{parentName:"p",href:"/overview/using-the-virtual-experiments-registry-ui"},"our web interface")," for browsing and\nexamining virtual experiments packages and runs. You can visit the\n",(0,i.yg)("a",{parentName:"p",href:"https://registry.st4sd.res.ibm.com/"},"ST4SD Global Registry")," for a first look.")),(0,i.yg)(h,{title:"No Code, No Fuss creation of Experiments",background:"true",pictogram:(0,i.yg)(o.PxR,{mdxType:"ArtTools_01"}),mdxType:"ExpressiveList"},(0,i.yg)("p",null,"Use\n",(0,i.yg)("a",{parentName:"p",href:"/overview/build-canvas"},"an interactive Build Canvas and a Graph Library"),"\nto create and modify experiments straight from your browser."))))}w.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-direct-run-mdx-4acba6ba0165a63ae2e4.js.map
"use strict";(self.webpackChunkst4sd_overview=self.webpackChunkst4sd_overview||[]).push([[2510],{63:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return l},default:function(){return d}});var t=a(45),o=(a(6540),a(5680)),i=a(8027);const r=["components"],l={},s=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.yg)("div",n)},p=s("PageDescription"),m=s("InlineNotification"),u=s("AnchorLinks"),c=s("AnchorLink"),g={_frontmatter:l},y=i.A;function d(e){let{components:n}=e,a=(0,t.A)(e,r);return(0,o.yg)(y,Object.assign({},g,a,{components:n,mdxType:"MDXLayout"}),(0,o.yg)(p,{mdxType:"PageDescription"},(0,o.yg)("p",null,"Use this page to learn about the new Domain Specific Language (DSL 2.0) of ST4SD and how it works.")),(0,o.yg)(m,{kind:"info",mdxType:"InlineNotification"},(0,o.yg)("p",null,"Here, we are using DSL 2.0, if you need to understand the previous syntax check out the ",(0,o.yg)("a",{parentName:"p",href:"/overview/workflow-specification"},"FlowIR docs"),".")),(0,o.yg)(u,{mdxType:"AnchorLinks"},(0,o.yg)(c,{mdxType:"AnchorLink"},"Namespace"),(0,o.yg)(c,{mdxType:"AnchorLink"},"Entrypoint"),(0,o.yg)(c,{mdxType:"AnchorLink"},"Workflow"),(0,o.yg)(c,{mdxType:"AnchorLink"},"Component"),(0,o.yg)(c,{mdxType:"AnchorLink"},"Assigning values to parameters"),(0,o.yg)(c,{mdxType:"AnchorLink"},"OutputReference"),(0,o.yg)(c,{mdxType:"AnchorLink"},"Example"),(0,o.yg)(c,{mdxType:"AnchorLink"},"Differences between DSL 2.0 and FlowIR")),(0,o.yg)("p",null,"DSL 2.0 is the new (and beta) way to define the computational graphs of ST4SD workflows."),(0,o.yg)("h2",null,"Namespace"),(0,o.yg)("p",null,"In DSL 2.0, a Computational Graph consists of Components which can be grouped under Workflow containers.\nIt also has an Entrypoint which points to the root node of the graph, which is an instance of a Component or Workflow template."),(0,o.yg)("p",null,"A Namespace is simply a container for the Component, Workflow, and Entrypoint definitions which represent the Computational Graph of one ST4SD workflow. "),(0,o.yg)("p",null,"Below is an example of a Namespace containing a single component that prints the message ",(0,o.yg)("inlineCode",{parentName:"p"},"Hello world")," to the terminal."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'entrypoint:\n  entry-instance: print\n  execute:\n  - target: "<entry-instance>"\n    args:\n      message: Hello world\ncomponents:\n- signature:\n    name: print\n    parameters:\n      name: message\n  command:\n    executable: echo\n    arguments: "%(message)s"\n')),(0,o.yg)("h2",null,"Entrypoint"),(0,o.yg)("p",null,"The Optional Entrypoint serves a single purpose. Describe how to execute root Template instance of the Computational Graph."),(0,o.yg)("p",null,"Its schema is:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'# This executes an instance of $template which is called "<entry-instance>"\nentry-instance: $template # name of a Component or Workflow template\nexecute: # an array with exactly 1 entry\n- target: <entry-instance> # which instance of a Template to execute.\n                           # In this scope there is only <entry-instance>\n  args:\n    $paramName: $value # one for each parameter of the template that\n                       # the "target" points to\n')),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"entry-instance")," field receives the name of a Template and creates an instance of it called ",(0,o.yg)("inlineCode",{parentName:"p"},"<entry-instance>"),".\nThe ",(0,o.yg)("inlineCode",{parentName:"p"},"execute")," field then describes how to “execute” the ",(0,o.yg)("inlineCode",{parentName:"p"},"<entry-instance>")," i.e. how to populate the arguments of the associated Template."),(0,o.yg)("p",null,"In ",(0,o.yg)("inlineCode",{parentName:"p"},"execute[].args")," you:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"must")," provide values for any parameters in the child ",(0,o.yg)("inlineCode",{parentName:"li"},"$template")," which do not have default values"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"may")," override the value of the parameters in ",(0,o.yg)("inlineCode",{parentName:"li"},"$template")," which have default values")),(0,o.yg)("p",null,"The Template instance that the entrypoint points to can have special parameters which are data references to paths that are external to the workflow.\nThese parameters must be called ",(0,o.yg)("inlineCode",{parentName:"p"},"input.$filename")," and they must not have default values in the signature of the Template definition.\nThe entrypoint ",(0,o.yg)("strong",{parentName:"p"},"may")," not explicitly override the values of said parameters, the runtime system will auto-generate them."),(0,o.yg)("p",null,"Consider a scenario where the Template that the ",(0,o.yg)("inlineCode",{parentName:"p"},"<entry-instance>")," step points to has a parameter called ",(0,o.yg)("inlineCode",{parentName:"p"},"input.my-input.db"),".\nThe runtime will post-process the ",(0,o.yg)("inlineCode",{parentName:"p"},"entrypoint.execute[0].args")," dictionary to include the following key-value pair:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'input.my-input.db: "input/my-input.db"\n')),(0,o.yg)("p",null,"In ",(0,o.yg)("a",{parentName:"p",href:"#assigning-values-to-parameters"},"Assigning values to parameters")," we describe in more detail how to assign values to parameters of Template instances in general."),(0,o.yg)("h2",null,"Workflow"),(0,o.yg)("p",null,"A Workflow is a Template that describes how to ",(0,o.yg)("inlineCode",{parentName:"p"},"execute")," a number of Template instances called ",(0,o.yg)("inlineCode",{parentName:"p"},"steps"),".\nIt has a ",(0,o.yg)("inlineCode",{parentName:"p"},"signature")," that consists of a unique ",(0,o.yg)("inlineCode",{parentName:"p"},"name")," and a ",(0,o.yg)("inlineCode",{parentName:"p"},"parameter")," list.\nEach such step can consume the outputs of a sibling step, or the parameters of the parent Workflow."),(0,o.yg)("p",null,"The outputs of a workflow are its ",(0,o.yg)("inlineCode",{parentName:"p"},"steps"),". The schema of Workflow is:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"signature:\n  name: $Template # the name of this Workflow Template - must be unique\n  parameters:\n    - name: $paramName\n      # optional default value\n      default: $value # str, number, or dictionary of {str: str/number}\nsteps: # which steps to instantiate\n  $stepName: $Template # for example child: simulation-code\nexecute: # how to execute the steps - one for each entry of steps\n- target: <$stepName> # for example <child> or <child/grandchild>\n  args:\n    $paramName: $value # one for each parameter of the Template that\n                       # .target points to\n")),(0,o.yg)("p",null,"In ",(0,o.yg)("a",{parentName:"p",href:"#assigning-values-to-parameters"},"Assigning values to parameters")," we describe how to assign values to parameters of Template instances."),(0,o.yg)("h2",null,"Component"),(0,o.yg)("p",null,"A Component describes how to ",(0,o.yg)("inlineCode",{parentName:"p"},"execute")," a task.\nJust like a Workflow Template, it has a ",(0,o.yg)("inlineCode",{parentName:"p"},"signature")," that consists of a ",(0,o.yg)("inlineCode",{parentName:"p"},"name")," and a ",(0,o.yg)("inlineCode",{parentName:"p"},"parameter")," list. "),(0,o.yg)("p",null,"The outputs of a Component are the paths under its working directory. "),(0,o.yg)("p",null,"The schema of a Component is:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'signature:\n  name: $Template # the name of this Component Template - must be unique\n  parameters:\n    - name: $paramName\n      # optional default value\n      default: $value # str, number, or dictionary of {str: str/number}\n# All the FlowIR fields, except for stage, name, references, and override\ncommand:\n  executable: str\n  arguments: str\n  environment: (null, str)\nworkflowAttributes:\n  aggregate: bool\n  replicate: (int, null, str containing %(value-reference)s)\nresourceRequest:\n  numberProcesses: (int, str containing %(value-reference)s)\n  numberThreads: (int, str containing %(value-reference)s)\n  ranksPerNode: (int, str containing %(value-reference)s)\n  threadsPerCore: (int, str containing %(value-reference)s)\n  memory: (int (size in bytes), str containing %(value-reference)s or Mib/Kib bytes )\n  gpus: (int, str containing %(value-reference)s)\nresourceManager:\n  config:\n    backend: (name of backend e.g local, kubernetes, lsf, docker)\n    walltime: (in minutes, valid for "kubernetes" and "lsf" backends, float)\n  docker:\n    image: str\n    imagePullPolicy: (Optional) one of Always (default), Never, IfNotPresent\n  kubernetes:\n    image: str\n  lsf:\n    queue: str\nvariables:\n  <variable name:str>: <value: str, int, bool, float>\n')),(0,o.yg)("p",null,"The above fields are the same as those in the ",(0,o.yg)("a",{parentName:"p",href:"/overview/workflow-specification/#component"},"Component section of the Workflow Specification in FlowIR"),"."),(0,o.yg)("p",null,"For more information, read our documentation on the ",(0,o.yg)("a",{parentName:"p",href:"/overview/workflow-specification#description-of-basic-flowir-component-fields"},"basic FlowIR component fields"),"."),(0,o.yg)("h2",null,"Assigning values to parameters"),(0,o.yg)("p",null,"Both Component and Workflow templates are instantiated in the same way:\nby declaring them as a ",(0,o.yg)("inlineCode",{parentName:"p"},"step")," and adding an entry to an ",(0,o.yg)("inlineCode",{parentName:"p"},"execute")," block which assigns values to the Template’s parameters."),(0,o.yg)("p",null,"The value of a parameter can be a number, string, or a key: value dictionary.\nThe body of a Template can reference its parameters like so ",(0,o.yg)("inlineCode",{parentName:"p"},"%(parameterName)s"),"."),(0,o.yg)("p",null,"When assigning a value to the parameters of a template via the ",(0,o.yg)("inlineCode",{parentName:"p"},"execute[].args")," dictionary"),(0,o.yg)("p",null,"In ",(0,o.yg)("inlineCode",{parentName:"p"},"execute[].args")," you:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"must")," provide values for any parameters in the child ",(0,o.yg)("inlineCode",{parentName:"li"},"$template")," which do not have default values"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"may")," override the value of the parameters in ",(0,o.yg)("inlineCode",{parentName:"li"},"$template")," which have default values"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"may")," use ",(0,o.yg)("inlineCode",{parentName:"li"},"OutputReferences")," to indicate dependencies to steps (definition follows this bullet list)"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"may")," use ",(0,o.yg)("inlineCode",{parentName:"li"},"%(parentParameter)s")," to indicate a dependency to the value that the parent parameter has. In turn that can be a dependency to the output of a Template instance or an input file or it might just be a literal constant"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"may")," use a ",(0,o.yg)("inlineCode",{parentName:"li"},"$key: $value")," dictionary to propagate a dictionary-type value. At the moment Template can only reference this kind of parameters to set the value of the ",(0,o.yg)("inlineCode",{parentName:"li"},"command.environment")," field of Components"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"may")," use ",(0,o.yg)("inlineCode",{parentName:"li"},"%(input.$filename)s"),"to propagate an input file reference from a parent to a step. ",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"Eventually a step must apply a ",(0,o.yg)("a",{parentName:"li",href:"/overview/workflow-specification/#datareference"},"DataReferences")," ",(0,o.yg)("inlineCode",{parentName:"li"},":$method")," to the parameter to indicates it wishes to consume the input file")))),(0,o.yg)("p",null,"Wanna find out more? Check out our ",(0,o.yg)("a",{parentName:"p",href:"#example"},"example"),"."),(0,o.yg)("h3",null,"OutputReference"),(0,o.yg)("p",null,"The format of an ",(0,o.yg)("inlineCode",{parentName:"p"},"OutputReference")," is:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"<$stepId>/$optionalPath:$optionalMethod\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"$stepId")," is a ",(0,o.yg)("inlineCode",{parentName:"p"},"/")," separated array of ",(0,o.yg)("inlineCode",{parentName:"p"},"stepNames")," starting from the scope of the current workflow. For example, the OutputReference ",(0,o.yg)("inlineCode",{parentName:"p"},"<one/child>/file.txt:ref")," resolves to the absolute path of the file ",(0,o.yg)("inlineCode",{parentName:"p"},"file.txt")," that the component ",(0,o.yg)("inlineCode",{parentName:"p"},"child")," produces under the sibling step ",(0,o.yg)("inlineCode",{parentName:"p"},"one")," which is an instance of a Workflow template. You can find more reference ",(0,o.yg)("inlineCode",{parentName:"p"},"methods")," in our ",(0,o.yg)("a",{parentName:"p",href:"/overview/workflow-specification/#datareference"},"DataReferences")," docs."),(0,o.yg)("h1",null,"Example"),(0,o.yg)("p",null,"Here is a simple example which uses one Workflow and one Component template two run 2 tasks."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"consume-input: prints the contents of an input file called ",(0,o.yg)("inlineCode",{parentName:"li"},"my-input.db")),(0,o.yg)("li",{parentName:"ul"},"consume-sibling: prints the text “my sibling said” followed by stdout of the sibling step ",(0,o.yg)("inlineCode",{parentName:"li"},"<consume-input>")," ")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'entrypoint:\n  entry-instance: main\n  execute:\n  - target: <entry-instance>\nworkflows:\n- signature:\n    name: main\n    parameters:\n    # special variable with auto-populated value\n    - name: input.my-input.db\n  steps:\n    consume-input: echo\n    consume-sibling: echo\n  execute:\n    - target: <consume-input>\n      args:\n        # resolves to the contents of the file \n        # that input.my-input-d points to\n        message: "%(input.my-input.db)s:output"\n    - target: <consume-sibling>\n      args:\n        # resolves to the stdout of step consume-input\n        message: "my sibling said <consume-input>:output"\ncomponents:\n- signature:\n    name: echo\n    parameters:\n      - name: message\n  command:\n    executable: "echo"\n    arguments: "%(message)s"\n')),(0,o.yg)("p",null,"To try it out, store the above DSL in a file called ",(0,o.yg)("inlineCode",{parentName:"p"},"dsl-params.yaml")," and run"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'pip install "st4sd-runtime-core[develop]"\n')),(0,o.yg)("p",null,"which installs the command-line-tool elaunch.py, followed by:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'echo "hello world" >my-input.db\nelaunch.py -i my-input.db --failSafeDelays=no -l40 dsl-params.yaml\n')),(0,o.yg)("h2",null,"Differences between DSL 2.0 and FlowIR"),(0,o.yg)("p",null,"There are some differences between DSL 2.0 and ",(0,o.yg)("a",{parentName:"p",href:"/overview/workflow-specification"},"FlowIR"),"."),(0,o.yg)("p",null,"In the current version (0.2.x) of DSL 2.0:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"we offer support for natural composition of Computational Graphs using Workflow and Component templates"),(0,o.yg)("li",{parentName:"ul"},"the ",(0,o.yg)("inlineCode",{parentName:"li"},"signature")," field replaces the ",(0,o.yg)("inlineCode",{parentName:"li"},"stage"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"name"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"references"),", and ",(0,o.yg)("inlineCode",{parentName:"li"},"override")," fields of the component specification in FlowIR"),(0,o.yg)("li",{parentName:"ul"},"settings and inputs flow through parameters, we do not support global/stage environments or variables"),(0,o.yg)("li",{parentName:"ul"},"the fields of components can contain ",(0,o.yg)("inlineCode",{parentName:"li"},"%(parameter)s")," references as well as component ",(0,o.yg)("inlineCode",{parentName:"li"},"%(variable)s")),(0,o.yg)("li",{parentName:"ul"},"dependencies between components are defined by referencing the output of a producer component in one parameter of the consumer component - ",(0,o.yg)("a",{parentName:"li",href:"/overview/workflow-specification/#datareference"},"DataReferences")," are reserved for referencing input files only",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"the equivalent of a DataReference for Template instances is an OutputReference"))),(0,o.yg)("li",{parentName:"ul"},"key-outputs and interface"),(0,o.yg)("li",{parentName:"ul"},"data files and manifests")),(0,o.yg)("p",null,"DSL 2.0 will eventually contain a superset of the FlowIR features. However, the current beta version of DSL 2.0 does not support:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"FlowIR platforms"),(0,o.yg)("li",{parentName:"ul"},"application-dependencies",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"however, you can use a manifest to implicitly define your application-dependencies")))))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-workflow-specification-dsl-mdx-b5a4a00c950fc776629f.js.map
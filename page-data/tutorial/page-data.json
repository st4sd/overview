{"componentChunkName":"component---src-pages-tutorial-mdx","path":"/tutorial/","result":{"pageContext":{"frontmatter":{"title":"Tutorial"},"relativePagePath":"/tutorial.mdx","titleType":"page","MdxNode":{"id":"cf15ec02-b1ef-5967-8658-c793a1508ea7","children":[],"parent":"61212955-321b-5fc8-b2fb-60ef4b493243","internal":{"content":"---\ntitle: Tutorial\n---\n\n<!--\n\n  Copyright IBM Inc. All Rights Reserved.\n  SPDX-License-Identifier: Apache-2.0\n\n-->\n\n<PageDescription>\n\nThis page will teach you how to write a workflow via a toy-example.\n\n</PageDescription>\n\n<AnchorLinks>\n  <AnchorLink>Introduction to FlowIR</AnchorLink>\n\n  <AnchorLink>The sum-numbers workflow</AnchorLink>\n  <AnchorLink>Providing inputs to workflows</AnchorLink>\n  <AnchorLink>Key-Outputs</AnchorLink>\n  <AnchorLink>Executing sum-numbers</AnchorLink>\n</AnchorLinks>\n\nOur toy-example calculates the sum of a set of integers. It can be found [here](https://github.com/st4sd/sum-numbers/) or cloned via:\n\n```\ngit clone https://github.com/st4sd/sum-numbers.git\n```\n\nBefore we dive into the `sum-numbers` example, first we give brief introduction to key-concepts of the language used to specify workflows in ST4SD, FlowIR. \n\n## Introduction to FlowIR\n\nWe term the internal workflow specification language of ST4SD, `FlowIR`. FlowIR is a feature rich workflow definition language for describing the computational graph of a virtual experiment.\n\nMore detailed information on FlowIR elements can be found in [workflow specification](/workflow-specification) which also references the `sum-numbers` workflow for illustration purposes.\n\n<InlineNotification>\n\nIn order to illustrate a wide-range of FlowIR features the sum-numbers example is slightly complex. The [hello world file](https://github.com/st4sd/sum-numbers/blob/main/hello_world.md) in the same repository contains a simpler `hello world` workflow.\n\n</InlineNotification>\n\n### Components\n\nIn `FlowIR` a workflow consists of components. These are the steps in the workflow or the nodes/vertices in the workflow graph. A workflow may also define  [key-outputs](/workflow-specification/#key-outputs), and [an interface](/writing-a-virtual-experiment-interface).  An interface allows easy retrieval of the properties measured by an instance of a workflow (virtual experiment).\n\nEach component is associated with a program or script and its command line arguments. A components inputs are files or directories. These come from other components in the workflow; or are provided by the user running the workflow; or are configuration files present in the workflow by default. Components produce their output under their working directory.\n\nA component defines its inputs using a `FlowIR` object called a `DataReference`. The set of `DataReferences` between components in a workflow defines the edges of the workflow graph. \n\n\n#### An example component\n\nLets look at how the first component in the `sum-numbers` workflow, **GenerateInput**, is defined\n\n```yaml\n- stage: 0\n  name: GenerateInput\n  command:\n    executable: \"bin/generate_input_file.py\"\n    arguments: \"%(numberOfPoints)s  %(my_random_seed)s\"\n```\n\n### Stages\n\nIn FlowIR, components can be optionally grouped into stages by the value of their `stage` key. For the above component you can see it is `stage: 0`.\n\nComponents which do not specify a `stage` are automatically grouped under `stage` 0. In the interest of keeping this grouping simple we currently only support `integers` as stage identifiers. Components in the same stage must have different names. The `st4sd-runtime` also raises an error if a stage contains no components.\n\n<InlineNotification>\nStages are a logical grouping. They do not define the execution order of components. A component is ready to execute once its input dependencies are satisfied. \n</InlineNotification>\n\n### Component Identifier\n\nThe`identifier` of a component is a string built out of the `stage` and `name` fields of the component like so: `stage{stage index}.{component name}`.\n\nThe identifier of our simple example component would be `stage0.GenerateInput`\n\n### DataReference\n\nA`DataReference` points to\n\n- data that exists before the workflow starts e.g. user provided inputs and configuration files\n- data that are generated  by a component in the workflow\n\n\n\nThe format of a `DataReference` is\n\n```\n <producer reference>[/<file reference>]:<type>\n```\n\nThere are 3 parts: `producer reference`, an optional `file reference`, and finally `type`\n\nThe `producer reference` can be either:\n\n1. A  full component identifier (e.g. `stage1.PartialSum`).\n2. A relative component identifier (e.g. `ExtractRow`). Relative component references assume that the addressed component is in the same stage as the referrer component.\n3. An absolute path.\n4. A  path relative to the top-level directory of the workflow instance directory e.g. `bin`, `data`, and `input`.\n\n<InlineNotification>\n\nYou define the directories that will be present in a workflow instance as part of writing the workflow - see [project types](/packaging-workflows).\n\n</InlineNotification>\n\nThe `file reference`  is an optional relative path to a folder or file that's hosted under the producer i.e. in a directory or produced by a component. If this part of the `DataReference` is omitted the `st4sd-runtime-core` treats the  `DataReference` as a pointing to the directory of the producer.\n\nThe third part of a `DataReference` is its `method`. This controls what the `st4sd-runtime` will do with the reference. See [here](/workflow-specification#datareference) for more information.\n\n<InlineNotification>\n\n`st4sd-runtime` guarantees that at runtime a `DataReference` will point to the desired component data. However the exact location of that data can be determined by the runtime. This allows you to write a workflow that consumes data from other components without have to be concerned about how that data is stored. \n\n</InlineNotification>\n\n\n\n#### DataReferences and Dependencies\n\n`DataReferences`indicate the dependencies between components as well as dependencies of components to the filesystem. \n\nA component will not start executing until either:\n\n1. The producers of its `DataReferences` have finished (sequential processing mode)\n2.  The producers of its `DataReferences` have started (co-processing mode). \n\nThe mode is defined by the component. \n\n#### Example\n\nLet's look at an example `DataReference` and decompose it\n\n```\nstage0.GenerateInput/output.csv:ref\n```\n\nThis `DataReference` points to the `output.csv` file (`/output.csv`) that the `stage0.GenerateInput` (producer identifier) component produces. The method is `ref` which means the `st4sd-runtime` will expand the `DataReference` to an absolute path to the referenced file. \n\nSee the `references` section in the [description of basic FlowIR component fields section](/workflow-specification#description-of-basic-flowir-component-fields).\n\n\n\n## The sum-numbers workflow\n\nThe workflow is defined in [conf/flowir_package.yaml](https://github.com/st4sd/sum-numbers/blob/main/conf/flowir_package.yaml) in the `sum-numbers` repository. In this toy workflow there are four components.\n\n1. **GenerateInput**: The first step a single task generates a file with `N`  lines each with 10 space separated numbers.\n2. **ExtractRow**: In the next step `N` tasks read this file in parallel and print 1 of the lines (from 1 to `N`).\n3. **PartialSum**: In this step for each of the above tasks, another task reads their output, sums the numbers and print the result (`N` tasks total)\n4. **Sum**: A final task aggregates all the partial sums, and prints the total sum.\n\nThe following sections show how to:\n\n1. Write simple components in FlowIR.\n2. Group components in stages and use `DataReferences` to define component input dependencies.\n3. Specify inputs to workflows.\n\n\n### Project structure\n\nThe ST4SD runtime supports two ways of structuring  workflow projects, `standard projects` and `standalone projects` - see [project types](/packaging-workflows). \n\n`sum-numbers` uses the `standalone project`  approach. In this project type, the workflow definition is stored under the `conf/flowir_package.yaml` file inside the root directory of the workflow project structure.\n\nFlowIR supports defining a workflow package using multiple files by means of importing sub-workflow documents. However, for simplicity we omit this information from this toy example.\n\n### Examining the `sum-numbers` components\n\n Component definitions are grouped under the top-level `components` field of the `flowir_package.yaml` file. The order of component definitions does define the execution order of the components - this is defined by the edges of the graph i.e. the `DataReferences` between the components.\n\nIn the snippet below we show the definition of 3 components, `stage1.ExtractRow`, `stage1.PartialSum`, and `stage2.Sum` from the `sum-numbers` example\n\n```yaml\n# ... omitted ...\ncomponents:\n# ... omitted ...\n- stage: 1\n  name: ExtractRow\n  command:\n    executable: \"bin/extract_row.py\"\n    arguments: \"stage0.GenerateInput/output.csv:ref %(replica)s\"\n  references:\n    - \"stage0.GenerateInput/output.csv:ref\"\n  workflowAttributes:\n    replicate: \"%(numberOfPoints)s\"\n\n- stage: 1\n  name: PartialSum\n  command:\n    executable: \"bin/sum.py\"\n    # Eliding the stage<integer> prefix defaults to the stage of the referencing\n    # component (PartialSum). Since ExtractRow is in the same stage with PartialSum:\n    arguments: \"ExtractRow:output\"\n  references:\n  - \"ExtractRow:output\"\n\n- stage: 2\n  name: Sum\n  command:\n    executable: \"bin/sum.py\"\n    arguments: \"stage1.PartialSum:output %(addToSum)s\"\n  references:\n    - \"stage1.PartialSum:output\"\n  workflowAttributes:\n    aggregate: True\n# ... omitted ...\n```\n\nLet's focus on `stage1.ExtractRow` first. Its `command` field specifies the executable and arguments. The executable is a relative path (`bin/extract_row.py`) as it does not start with a `/` character. The `st4sd-runtime` interprets this to look for the `extract_row.py` executable under the `bin` folder of the workflow package definition. If the executable was an absolute path, or did not contain any `/` characters it'd be resolved using the `$PATH` environment variable of the `ExtractRow` component. See [environments](/workflow-specification#environments) for information on defining and using environment variables.\n\nThe arguments string of `stage1.ExtractRow` are `stage0.GenerateInput/output.csv:ref %(replica)s`. It consists of a `DataReference` (`stage0.GenerateInput/output.csv:ref`) and a variable reference (`%(replica)s`). The `DataReference` will resolve to the absolute path of the file `output.csv` which is produced by the `GenerateInput` component in stage `0`.\n\nNotice that the `DataReference` is also part of the `references` array. All component references must be written in this array, otherwise the `st4sd-runtime` raises an invalid workflow package exception. This is primarily for error-checking. We also support more `DataReference` methods which cannot be a part of the `command.arguments` field. See the `references` section in the [description of basic FlowIR component fields section](/workflow-specification#description-of-basic-flowir-component-fields).\n\nThe variable reference `%(replica)s` instructs the `st4sd-runtime` to replace the reference with the value of the variable. See the [variables section](/workflow-specification#variables) more information about variables, and variable scope. In this particular instance, the `replica` variable is a special one. It is automatically generated by the `st4sd-runtime` for components which contain the `workflowAttributes.replicate` field. In this instance, the `st4sd-runtime` will generate `numberOfPoints` replicas of the `ExtractRow` component. Each of these replicas will have a `replica` variable with one value out of the integer range `[0, numberOfPoints)` (in this particular example the value range is `[0, 1, 2]`).\n\nNext up is the `PartialSum` component. Notice its arguments `ExtractRow:output`. This is a DataReference with a relative-component-reference, so the `st4sd-runtime` understands that this is a reference to `stage1.ExtractRow`. However, recall that `stage1.ExtractRow` component is a replicated component. How does the `st4sd-runttime` pick, which of those components to reference here?\n\nBecause the `stage1.PartialSum` component does not contain a `workflowAttributes.aggregate` option, the `st4sd-runtime` will also replicate `PartialSum` the same number of times as its upstream replicated component (i.e. `stage1.ExtractRow`). It will then resolve the reference of replica `X` of `stage1.PartialSum` to the replica `X` of `stage1.ExtractRow`.\n\nComponent `stage2.Sum` is an example of an `aggregating` component. Aggregated components do not get replicated by the `st4sd-runtime`, they act as a sentinel node in the computational graph which stops the replication propagation.\n\nThe arguments of this component are `stage1.PartialSum:output %(addToSum)s`. The `st4sd-runtime` will first replace the `stage1.PartialSum:output` DataReference to multiple space separated DataReferences. One for each replica like so:`stage1.PartialSum0:output stage1.PartialSum1:output stage1.PartialSum2:output`. Right before the execution of the component, these DataRereferences to replicas will be expanded to the stdout contents of each of the 3 components.\n\n## Providing inputs to workflows\n\nST4SD workflows support 3 flavours of inputs:\n\n1. Input files - files user must provide when they execute the workflow\n2. Data files - configuration files that optionally can be overridden\n3. User variables - user provided values for workflow variables\n\n### Input Files\n\nInput files are the files you require a user to provide. You define them implicitly whenever you have a data-reference to a file in a top-level folder called `input/` i.e.\n\n```\ninput/<filename>:<DataReference type>\n```\n\nYou don't include input files in a workflow project. \nAs a result for each data-reference to a file in `input/` you have in your worklfow configuration, the user *must* provide a matching input file when they launch the workflow.\nFor example if directly running the workflow they would use the `-i` option to `elaunch.py`.\n\nWhen the workflow execution starts, `st4sd-runtime-core` creates the `input/` directory in the top-level of the workflow instance directory and copies the files the user provided for the inputs into this folder.\nIn this way the input files are where components expect them to be at runtime.\n\n`st4sd-runtime-core` will check all required input files are present before starting the workflow and stop, raising an error, if they are not.\n\n\n### Data files\n\n\nData files are configuration files users can optionally override. \nYou define them implicitly whenever you have a data-reference to file in a top-level folder called `data/` i.e.\n\n```\ndata/<filename>:<DataReference type>\n```\n\nYou must provide defaults for these files. \nIf you are using a [standard project structure](/packaging-workflows#standard-project) you do this by placing all the data files in a directory and then using a manifest to specify that this directory should be used as the data directory. \nFor example, if you put all the data files in a directory called `shared_data` your manifest would look like: \n```\ndata: ../shared_data\n```\n\nIf you are are using a [standalone project structure](/packaging-workflows#standalone-project) then the data-files are placed in the `data` folder of your project.\n\nIn the sum-numbers example the `stage3.Cat` component references one such data file:\n\n```yaml\n# ... omitted ...\ncomponents:\n# ... omitted ...\n- stage: 3\n  name: Cat\n  command:\n    executable: \"cat\"\n    arguments: \"cat_me.txt\"\n  references:\n    - \"data/cat_me.txt:copy\"\n# ... omitted ...\n```\n\nIn this example the `st4sd-runtime` will copy the file `$INSTANCE_DIR/data/cat_me.txt` into the working directory of the `stage3.Cat` file right before the component executes. \n\nThe `st4sd-runtime` supports replacing files under the `data` folder via the `-d` option of `elaunch.py`. Keep in mind that the argument to `-d` must be the absolute, or relative, path to a file whose name matches one of the files under the `data` folder. If there's no `-d` option to override a `data` file, the `st4sd-runtime` will use the one provided by the workflow package to fulfil the DataReferences to it.\n\n\n### Variables\n\nFinally, the `st4sd-runtime` supports providing a file containing user defined variables via the `-a` commandline argument to the `elaunch.py` script. User variables overwrite global and stage variables but not variables defined by components. The schema of the file is:\n\n```yaml\nglobal: # dictionary of variables which are visible to all components\n  name: some-primitive-value(str, float, int)\nstages:\n  stageIndex(integer): # dictionary of variables visible to components in stageIndex\n    name: some-primitive-value(str, float, int)\n```\n\nUser variables can be used to overwrite the behaviour of components (e.g. arguments or even FlowIR configuration fields). Here is an example user-variables file for this workflow which changes the number of replicas from 3 to just 1:\n\n```yaml\nglobal:\n  numberOfPoints: 1\n```\n\nCurrently, we expect that user variables are stored in a file with the extension `.yaml` OR `.yml`. The [variables section](/workflow-specification#variables) contains more information about variables and variable scopes.\n\n## Key-Outputs\n\n[Key-Outputs](/workflow-specification#key-outputs) are named `DataReferences` that point to important paths which the virtual experiment produced.\n\nIn sum-numbers there is only 1 key-output with the name `TotalSum`. It points to a file `out.stdout` that the `stage2.Sum` component produces.\nThis file contains the sum of all the numbers that this toy virtual experiment calculates.DataReferences\n\nThis is the relevant FlowIR snippet from sum-numbers:\n\n```yaml\noutput:\n  TotalSum:\n    data-in: \"stage2.Sum/out.stdout:copy\"\n```\n\n## Executing `sum-numbers`\n\nThis section assumes that you've already installed [st4sd-runtime-core](/installation#set-up-local-client) locally and cloned `sum-numbers`. If you've installed `st4sd-runtime-core` in a virtual environment take a moment to load it before continuing.\n\nTo execute this workflow use `elaunch.py` (the script should take a couple of minutes to complete).\n\n```bash\nelaunch.py sum-numbers\n```\n\nAn `instance directory` will be created in the directory you execute `elaunch.py`.  The instance directory will have the name `sum-numbers-<TIMESTAMP>.instance` (in the example below: `sum-numbers-2021-03-01T094529.183587`).\n\nEach `sum-numbers` workflow component has its own working directory under the instance directory called: `$INSTANCE_DIR/stages/stage<stage_index:%d>/<component_name>/`.\n\n `elaunch.py` will output text that is similar to the following:\n\n```bash\n$ elaunch.py sum-numbers\nUnable to import pythonlsf - limited LSF functionality will be available\nINFO      MainThread                     root                          : point_logger_to_random_file 2021-03-01 09:45:29,125: Experiment log at /tmp/tmpso2ajxxe\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,126: Using modules in /home/username/projects/st4sd-runtime/python/experiment\nINFO      MainThread                     root                          : CreateHaltClosure    2021-03-01 09:45:29,126: Creating halt closure monitoring /home/shared/CHPCBackend/.halt_backend for pid 888\nINFO      MainThread                     root                          : CreateHaltClosure    2021-03-01 09:45:29,126: Creating halt closure monitoring /home/shared/CHPCBackend/.kill_backend for pid 888\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,126: Deploying Experiment at SumNumbers.package/ \nINFO      MainThread                     FlowIRConf                    : __init__             2021-03-01 09:45:29,127: Load FLOWIR, the default platform is default\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,151: Replicate job stage1.ExtractRow (3) (replicated refs: [])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,151: Replicate job stage1.PartialSum (3) (replicated refs: ['ExtractRow:output'])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,152: Aggregate job stage2.Sum\nINFO      MainThread                     root                          : ValidatePackage      2021-03-01 09:45:29,183: <experiment.conf.FlowIRExperimentConfiguration object at 0x7fc55fe10eb0>\nWARNING   MainThread                     root                          : ValidatePackage      2021-03-01 09:45:29,183: TESTING EXPERIMENT FROM PACKAGE\nINFO      MainThread                     FlowIRConf                    : __init__             2021-03-01 09:45:29,229: Load FLOWIR, the default platform is default\nINFO      MainThread                     data.experiment               : experimentFromPackage 2021-03-01 09:45:29,258: Detected use of virtual env - will link in python bin directory\nINFO      MainThread                     data.experiment               : experimentFromPackage 2021-03-01 09:45:29,259: Created python link /home/username/projects/packages/SumNumbers-2021-03-01T094529.183587.instance/python to /home/username/anaconda2/envs/flow3.8\nWARNING   MainThread                     data.experiment               : __init__             2021-03-01 09:45:29,259: Explicitly instructed to load a package\nINFO      MainThread                     FlowIRConf                    : __init__             2021-03-01 09:45:29,259: Load FLOWIR, the default platform is default\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,317: Replicate job stage1.ExtractRow (3) (replicated refs: [])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,318: Replicate job stage1.PartialSum (3) (replicated refs: ['ExtractRow:output'])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,318: Aggregate job stage2.Sum\nINFO      MainThread                     root                          : ValidatePackage      2021-03-01 09:45:29,355: Created experiment: There are 4 stages. Current stage 0\nINFO      MainThread                     root                          : point_logger_to_logfile 2021-03-01 09:45:29,355: Experiment log at /home/username/projects/packages/SumNumbers-2021-03-01T094529.183587.instance/output/experiment.log\nWARNING   MainThread                     executors.localchecker        : _findExecutablePath  2021-03-01 09:45:29,370: Found pathless executable (cat) - checking if resolvable in command environment\nINFO      MainThread                     executors.localchecker        : _findExecutablePath  2021-03-01 09:45:29,378: Found executable in command environment - using /usr/bin/cat\nDEBUG     MainThread                     output.outputmonitor          : checkDataReferences  2021-03-01 09:45:29,387: Monitoring /home/username/projects/packages/SumNumbers-2021-03-01T094529.183587.instance/stages/stage2/Sum/out.stdout\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,391: Status after deployment:\nINFO      MainThread                     control.controller            : parse_workflow_graph 2021-03-01 09:45:29,417: Updating WorkflowGraph\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,417: Starting Experiment\nINFO      StatusMonitor                  output.statusmonitor          : CheckStatus          2021-03-01 09:45:29,435: No stage running\nINFO      MainThread                     root                          : Run                  2021-03-01 09:45:29,435: Running Stage 0 (stage0) with 1 jobs. Data located at SumNumbers-2021-03-01T094529.183587.instance/stages/stage0\nINFO      MainThread                     control.controller            : initialise           2021-03-01 09:45:29,436: Initial dependency analysis:<Component(s) report>\n  stage0.GenerateInput[pending] inputs: []\n  stage1.ExtractRow1[pending] inputs: [stage0.GenerateInput]\n  stage1.PartialSum1[pending] inputs: [stage1.ExtractRow1]\n  stage1.ExtractRow2[pending] inputs: [stage0.GenerateInput]\n  stage1.PartialSum2[pending] inputs: [stage1.ExtractRow2]\n  stage1.ExtractRow0[pending] inputs: [stage0.GenerateInput]\n  stage1.PartialSum0[pending] inputs: [stage1.ExtractRow0]\n  stage2.Sum[pending] inputs: [stage1.PartialSum0, stage1.PartialSum1, stage1.PartialSum2]\n  stage3.Cat[pending] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     output.outputmonitor          : run                  2021-03-01 09:45:29,437: No output to monitor in stage 0\nINFO      MainThread                     control.controller            : run                  2021-03-01 09:45:29,437: Report for stage 0\n<Component(s) report>\n  stage0.GenerateInput[pending] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:29,438: System appears stable - no new exceptions in last 30 secs\nWARNING   MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:29,439: Waited 0 seconds (max 120)\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:29,439: <Check for promotions>\nREADY stage3.Cat in stage 0\nREADY stage0.GenerateInput in stage 0\n<\\Check for promotions>\n...\nINFO      MainThread                     control.controller            : run                  2021-03-01 09:45:39,513: Stage 0 complete. Total components 1\nINFO_MED  MainThread                     output.outputmonitor          : kill                 2021-03-01 09:45:39,514: Received kill\nINFO_MED  MainThread                     output.outputmonitor          : kill                 2021-03-01 09:45:39,514: Setting cancel copy event: <threading.Event object at 0x7fc55c4adb80>\nINFO      MainThread                     root                          : Run                  2021-03-01 09:45:39,515: Stage 0 complete\nINFO      MainThread                     root                          : Run                  2021-03-01 09:45:39,516: Running Stage 1 (stage1) with 6 jobs. Data located at SumNumbers-2021-03-01T094529.183587.instance/stages/stage1\nINFO      MainThread                     control.controller            : initialise           2021-03-01 09:45:39,526: Initial dependency analysis:<Component(s) report>\n  stage0.GenerateInput[finished] inputs: []\n  stage1.ExtractRow1[pending] inputs: []\n  stage1.PartialSum1[pending] inputs: [stage1.ExtractRow1]\n  stage1.ExtractRow2[pending] inputs: []\n  stage1.PartialSum2[pending] inputs: [stage1.ExtractRow2]\n  stage1.ExtractRow0[pending] inputs: []\n  stage1.PartialSum0[pending] inputs: [stage1.ExtractRow0]\n  stage2.Sum[pending] inputs: [stage1.PartialSum0, stage1.PartialSum1, stage1.PartialSum2]\n  stage3.Cat[finished] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     output.outputmonitor          : run                  2021-03-01 09:45:39,527: No output to monitor in stage 1\nINFO      MainThread                     control.controller            : run                  2021-03-01 09:45:39,532: Report for stage 1\n<Component(s) report>\n  stage1.PartialSum2[pending] inputs: [stage1.ExtractRow2]\n  stage1.ExtractRow0[pending] inputs: []\n  stage1.ExtractRow2[pending] inputs: []\n  stage1.PartialSum0[pending] inputs: [stage1.ExtractRow0]\n  stage1.PartialSum1[pending] inputs: [stage1.ExtractRow1]\n  stage1.ExtractRow1[pending] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:39,544: System appears stable - no new exceptions in last 30 secs\nWARNING   MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:39,545: Waited 0 seconds (max 120)\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,547: <Check for promotions>\nREADY stage1.ExtractRow0 in stage 1\nREADY stage1.ExtractRow2 in stage 1\nREADY stage1.ExtractRow1 in stage 1\n<\\Check for promotions>\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,547: Staging in component stage1.ExtractRow0\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,566: Staging in component stage1.ExtractRow2\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,574: Staging in component stage1.ExtractRow1\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,586: Submitting component stage1.ExtractRow0\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,588: Submitting component stage1.ExtractRow2\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,590: Submitting component stage1.ExtractRow1\n...\nINFO      StatusMonitor                  output.statusmonitor          : CheckStatus          2021-03-01 09:46:09,811: <Component(s) report>\n  stage0.GenerateInput[finished] inputs: []\n  stage1.ExtractRow1[finished] inputs: []\n  stage1.PartialSum1[finished] inputs: []\n  stage1.ExtractRow2[finished] inputs: []\n  stage1.PartialSum2[finished] inputs: []\n  stage1.ExtractRow0[finished] inputs: []\n  stage1.PartialSum0[finished] inputs: []\n  stage2.Sum[finished] inputs: []\n  stage3.Cat[finished] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     root                          : <module>             2021-03-01 09:46:09,811: \tThread-4\nINFO      StatusMonitor                  output.statusmonitor          : CheckStatus          2021-03-01 09:46:09,811: Status of stage3: 1.0000 1.0000 finished (active-stages: {3:1.00})\n...\nINFO      MainThread                     root                          : <module>             2021-03-01 09:46:44,868: Clean-up - Final status was\ncost=0\ncurrent-stage=stage3\nexit-status=Success\nexperiment-state=finished\nstage-progress=1.0\nstage-state=finished\nstages=['stage0', 'stage1', 'stage2', 'stage3']\ntotal-progress=1.0\nupdated=2021-03-01 09:46:44.866733\n...\nINFO      MainThread                     root                          : <module>             2021-03-01 09:46:44,877: Experiment complete\nINFO      ThreadPoolExecutor-13_0        db.status                     : _closeConnection     2021-03-01 09:46:44,885: Connection closed\n```\n\nIf you switch to the `$INSTANCE_DIR/stages` directory and run `ls -lR` you should see the below structure:\n\n```\n$ ls -lR\n.:\ntotal 16\ndrwxrwxr-x. 3 username username 4096 Mar  1 09:45 stage0\ndrwxrwxr-x. 8 username username 4096 Mar  1 09:45 stage1\ndrwxrwxr-x. 3 username username 4096 Mar  1 09:45 stage2\ndrwxrwxr-x. 3 username username 4096 Mar  1 09:45 stage3\n\n./stage0:\ntotal 4\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 GenerateInput\n\n./stage0/GenerateInput:\ntotal 12\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username  13 Mar  1 09:45 output.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username  17 Mar  1 09:45 out.stdout\n\n./stage1:\ntotal 24\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 ExtractRow0\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 ExtractRow1\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 ExtractRow2\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 PartialSum0\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 PartialSum1\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 PartialSum2\n\n./stage1/ExtractRow0:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   4 Mar  1 09:45 out.stdout\n\n./stage1/ExtractRow1:\ntotal 8\n-rw-rw-r--. 1 username username 308 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   4 Mar  1 09:45 out.stdout\n\n./stage1/ExtractRow2:\ntotal 8\n-rw-rw-r--. 1 username username 308 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   5 Mar  1 09:45 out.stdout\n\n./stage1/PartialSum0:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   2 Mar  1 09:45 out.stdout\n\n./stage1/PartialSum1:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   3 Mar  1 09:45 out.stdout\n\n./stage1/PartialSum2:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   3 Mar  1 09:45 out.stdout\n\n./stage2:\ntotal 4\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:46 Sum\n\n./stage2/Sum:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:46 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:46 out.stderr\n-rw-rw-r--. 1 username username   3 Mar  1 09:46 out.stdout\n\n./stage3:\ntotal 4\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 Cat\n\n./stage3/Cat:\ntotal 12\n-rw-rw-r--. 1 username username  34 Mar  1 09:45 cat_me.txt\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username  34 Mar  1 09:45 out.stdout\n```\n","type":"Mdx","contentDigest":"d2be0e69e3c2374f8f755042dd3a0ec8","owner":"gatsby-plugin-mdx","counter":279},"frontmatter":{"title":"Tutorial"},"exports":{},"rawBody":"---\ntitle: Tutorial\n---\n\n<!--\n\n  Copyright IBM Inc. All Rights Reserved.\n  SPDX-License-Identifier: Apache-2.0\n\n-->\n\n<PageDescription>\n\nThis page will teach you how to write a workflow via a toy-example.\n\n</PageDescription>\n\n<AnchorLinks>\n  <AnchorLink>Introduction to FlowIR</AnchorLink>\n\n  <AnchorLink>The sum-numbers workflow</AnchorLink>\n  <AnchorLink>Providing inputs to workflows</AnchorLink>\n  <AnchorLink>Key-Outputs</AnchorLink>\n  <AnchorLink>Executing sum-numbers</AnchorLink>\n</AnchorLinks>\n\nOur toy-example calculates the sum of a set of integers. It can be found [here](https://github.com/st4sd/sum-numbers/) or cloned via:\n\n```\ngit clone https://github.com/st4sd/sum-numbers.git\n```\n\nBefore we dive into the `sum-numbers` example, first we give brief introduction to key-concepts of the language used to specify workflows in ST4SD, FlowIR. \n\n## Introduction to FlowIR\n\nWe term the internal workflow specification language of ST4SD, `FlowIR`. FlowIR is a feature rich workflow definition language for describing the computational graph of a virtual experiment.\n\nMore detailed information on FlowIR elements can be found in [workflow specification](/workflow-specification) which also references the `sum-numbers` workflow for illustration purposes.\n\n<InlineNotification>\n\nIn order to illustrate a wide-range of FlowIR features the sum-numbers example is slightly complex. The [hello world file](https://github.com/st4sd/sum-numbers/blob/main/hello_world.md) in the same repository contains a simpler `hello world` workflow.\n\n</InlineNotification>\n\n### Components\n\nIn `FlowIR` a workflow consists of components. These are the steps in the workflow or the nodes/vertices in the workflow graph. A workflow may also define  [key-outputs](/workflow-specification/#key-outputs), and [an interface](/writing-a-virtual-experiment-interface).  An interface allows easy retrieval of the properties measured by an instance of a workflow (virtual experiment).\n\nEach component is associated with a program or script and its command line arguments. A components inputs are files or directories. These come from other components in the workflow; or are provided by the user running the workflow; or are configuration files present in the workflow by default. Components produce their output under their working directory.\n\nA component defines its inputs using a `FlowIR` object called a `DataReference`. The set of `DataReferences` between components in a workflow defines the edges of the workflow graph. \n\n\n#### An example component\n\nLets look at how the first component in the `sum-numbers` workflow, **GenerateInput**, is defined\n\n```yaml\n- stage: 0\n  name: GenerateInput\n  command:\n    executable: \"bin/generate_input_file.py\"\n    arguments: \"%(numberOfPoints)s  %(my_random_seed)s\"\n```\n\n### Stages\n\nIn FlowIR, components can be optionally grouped into stages by the value of their `stage` key. For the above component you can see it is `stage: 0`.\n\nComponents which do not specify a `stage` are automatically grouped under `stage` 0. In the interest of keeping this grouping simple we currently only support `integers` as stage identifiers. Components in the same stage must have different names. The `st4sd-runtime` also raises an error if a stage contains no components.\n\n<InlineNotification>\nStages are a logical grouping. They do not define the execution order of components. A component is ready to execute once its input dependencies are satisfied. \n</InlineNotification>\n\n### Component Identifier\n\nThe`identifier` of a component is a string built out of the `stage` and `name` fields of the component like so: `stage{stage index}.{component name}`.\n\nThe identifier of our simple example component would be `stage0.GenerateInput`\n\n### DataReference\n\nA`DataReference` points to\n\n- data that exists before the workflow starts e.g. user provided inputs and configuration files\n- data that are generated  by a component in the workflow\n\n\n\nThe format of a `DataReference` is\n\n```\n <producer reference>[/<file reference>]:<type>\n```\n\nThere are 3 parts: `producer reference`, an optional `file reference`, and finally `type`\n\nThe `producer reference` can be either:\n\n1. A  full component identifier (e.g. `stage1.PartialSum`).\n2. A relative component identifier (e.g. `ExtractRow`). Relative component references assume that the addressed component is in the same stage as the referrer component.\n3. An absolute path.\n4. A  path relative to the top-level directory of the workflow instance directory e.g. `bin`, `data`, and `input`.\n\n<InlineNotification>\n\nYou define the directories that will be present in a workflow instance as part of writing the workflow - see [project types](/packaging-workflows).\n\n</InlineNotification>\n\nThe `file reference`  is an optional relative path to a folder or file that's hosted under the producer i.e. in a directory or produced by a component. If this part of the `DataReference` is omitted the `st4sd-runtime-core` treats the  `DataReference` as a pointing to the directory of the producer.\n\nThe third part of a `DataReference` is its `method`. This controls what the `st4sd-runtime` will do with the reference. See [here](/workflow-specification#datareference) for more information.\n\n<InlineNotification>\n\n`st4sd-runtime` guarantees that at runtime a `DataReference` will point to the desired component data. However the exact location of that data can be determined by the runtime. This allows you to write a workflow that consumes data from other components without have to be concerned about how that data is stored. \n\n</InlineNotification>\n\n\n\n#### DataReferences and Dependencies\n\n`DataReferences`indicate the dependencies between components as well as dependencies of components to the filesystem. \n\nA component will not start executing until either:\n\n1. The producers of its `DataReferences` have finished (sequential processing mode)\n2.  The producers of its `DataReferences` have started (co-processing mode). \n\nThe mode is defined by the component. \n\n#### Example\n\nLet's look at an example `DataReference` and decompose it\n\n```\nstage0.GenerateInput/output.csv:ref\n```\n\nThis `DataReference` points to the `output.csv` file (`/output.csv`) that the `stage0.GenerateInput` (producer identifier) component produces. The method is `ref` which means the `st4sd-runtime` will expand the `DataReference` to an absolute path to the referenced file. \n\nSee the `references` section in the [description of basic FlowIR component fields section](/workflow-specification#description-of-basic-flowir-component-fields).\n\n\n\n## The sum-numbers workflow\n\nThe workflow is defined in [conf/flowir_package.yaml](https://github.com/st4sd/sum-numbers/blob/main/conf/flowir_package.yaml) in the `sum-numbers` repository. In this toy workflow there are four components.\n\n1. **GenerateInput**: The first step a single task generates a file with `N`  lines each with 10 space separated numbers.\n2. **ExtractRow**: In the next step `N` tasks read this file in parallel and print 1 of the lines (from 1 to `N`).\n3. **PartialSum**: In this step for each of the above tasks, another task reads their output, sums the numbers and print the result (`N` tasks total)\n4. **Sum**: A final task aggregates all the partial sums, and prints the total sum.\n\nThe following sections show how to:\n\n1. Write simple components in FlowIR.\n2. Group components in stages and use `DataReferences` to define component input dependencies.\n3. Specify inputs to workflows.\n\n\n### Project structure\n\nThe ST4SD runtime supports two ways of structuring  workflow projects, `standard projects` and `standalone projects` - see [project types](/packaging-workflows). \n\n`sum-numbers` uses the `standalone project`  approach. In this project type, the workflow definition is stored under the `conf/flowir_package.yaml` file inside the root directory of the workflow project structure.\n\nFlowIR supports defining a workflow package using multiple files by means of importing sub-workflow documents. However, for simplicity we omit this information from this toy example.\n\n### Examining the `sum-numbers` components\n\n Component definitions are grouped under the top-level `components` field of the `flowir_package.yaml` file. The order of component definitions does define the execution order of the components - this is defined by the edges of the graph i.e. the `DataReferences` between the components.\n\nIn the snippet below we show the definition of 3 components, `stage1.ExtractRow`, `stage1.PartialSum`, and `stage2.Sum` from the `sum-numbers` example\n\n```yaml\n# ... omitted ...\ncomponents:\n# ... omitted ...\n- stage: 1\n  name: ExtractRow\n  command:\n    executable: \"bin/extract_row.py\"\n    arguments: \"stage0.GenerateInput/output.csv:ref %(replica)s\"\n  references:\n    - \"stage0.GenerateInput/output.csv:ref\"\n  workflowAttributes:\n    replicate: \"%(numberOfPoints)s\"\n\n- stage: 1\n  name: PartialSum\n  command:\n    executable: \"bin/sum.py\"\n    # Eliding the stage<integer> prefix defaults to the stage of the referencing\n    # component (PartialSum). Since ExtractRow is in the same stage with PartialSum:\n    arguments: \"ExtractRow:output\"\n  references:\n  - \"ExtractRow:output\"\n\n- stage: 2\n  name: Sum\n  command:\n    executable: \"bin/sum.py\"\n    arguments: \"stage1.PartialSum:output %(addToSum)s\"\n  references:\n    - \"stage1.PartialSum:output\"\n  workflowAttributes:\n    aggregate: True\n# ... omitted ...\n```\n\nLet's focus on `stage1.ExtractRow` first. Its `command` field specifies the executable and arguments. The executable is a relative path (`bin/extract_row.py`) as it does not start with a `/` character. The `st4sd-runtime` interprets this to look for the `extract_row.py` executable under the `bin` folder of the workflow package definition. If the executable was an absolute path, or did not contain any `/` characters it'd be resolved using the `$PATH` environment variable of the `ExtractRow` component. See [environments](/workflow-specification#environments) for information on defining and using environment variables.\n\nThe arguments string of `stage1.ExtractRow` are `stage0.GenerateInput/output.csv:ref %(replica)s`. It consists of a `DataReference` (`stage0.GenerateInput/output.csv:ref`) and a variable reference (`%(replica)s`). The `DataReference` will resolve to the absolute path of the file `output.csv` which is produced by the `GenerateInput` component in stage `0`.\n\nNotice that the `DataReference` is also part of the `references` array. All component references must be written in this array, otherwise the `st4sd-runtime` raises an invalid workflow package exception. This is primarily for error-checking. We also support more `DataReference` methods which cannot be a part of the `command.arguments` field. See the `references` section in the [description of basic FlowIR component fields section](/workflow-specification#description-of-basic-flowir-component-fields).\n\nThe variable reference `%(replica)s` instructs the `st4sd-runtime` to replace the reference with the value of the variable. See the [variables section](/workflow-specification#variables) more information about variables, and variable scope. In this particular instance, the `replica` variable is a special one. It is automatically generated by the `st4sd-runtime` for components which contain the `workflowAttributes.replicate` field. In this instance, the `st4sd-runtime` will generate `numberOfPoints` replicas of the `ExtractRow` component. Each of these replicas will have a `replica` variable with one value out of the integer range `[0, numberOfPoints)` (in this particular example the value range is `[0, 1, 2]`).\n\nNext up is the `PartialSum` component. Notice its arguments `ExtractRow:output`. This is a DataReference with a relative-component-reference, so the `st4sd-runtime` understands that this is a reference to `stage1.ExtractRow`. However, recall that `stage1.ExtractRow` component is a replicated component. How does the `st4sd-runttime` pick, which of those components to reference here?\n\nBecause the `stage1.PartialSum` component does not contain a `workflowAttributes.aggregate` option, the `st4sd-runtime` will also replicate `PartialSum` the same number of times as its upstream replicated component (i.e. `stage1.ExtractRow`). It will then resolve the reference of replica `X` of `stage1.PartialSum` to the replica `X` of `stage1.ExtractRow`.\n\nComponent `stage2.Sum` is an example of an `aggregating` component. Aggregated components do not get replicated by the `st4sd-runtime`, they act as a sentinel node in the computational graph which stops the replication propagation.\n\nThe arguments of this component are `stage1.PartialSum:output %(addToSum)s`. The `st4sd-runtime` will first replace the `stage1.PartialSum:output` DataReference to multiple space separated DataReferences. One for each replica like so:`stage1.PartialSum0:output stage1.PartialSum1:output stage1.PartialSum2:output`. Right before the execution of the component, these DataRereferences to replicas will be expanded to the stdout contents of each of the 3 components.\n\n## Providing inputs to workflows\n\nST4SD workflows support 3 flavours of inputs:\n\n1. Input files - files user must provide when they execute the workflow\n2. Data files - configuration files that optionally can be overridden\n3. User variables - user provided values for workflow variables\n\n### Input Files\n\nInput files are the files you require a user to provide. You define them implicitly whenever you have a data-reference to a file in a top-level folder called `input/` i.e.\n\n```\ninput/<filename>:<DataReference type>\n```\n\nYou don't include input files in a workflow project. \nAs a result for each data-reference to a file in `input/` you have in your worklfow configuration, the user *must* provide a matching input file when they launch the workflow.\nFor example if directly running the workflow they would use the `-i` option to `elaunch.py`.\n\nWhen the workflow execution starts, `st4sd-runtime-core` creates the `input/` directory in the top-level of the workflow instance directory and copies the files the user provided for the inputs into this folder.\nIn this way the input files are where components expect them to be at runtime.\n\n`st4sd-runtime-core` will check all required input files are present before starting the workflow and stop, raising an error, if they are not.\n\n\n### Data files\n\n\nData files are configuration files users can optionally override. \nYou define them implicitly whenever you have a data-reference to file in a top-level folder called `data/` i.e.\n\n```\ndata/<filename>:<DataReference type>\n```\n\nYou must provide defaults for these files. \nIf you are using a [standard project structure](/packaging-workflows#standard-project) you do this by placing all the data files in a directory and then using a manifest to specify that this directory should be used as the data directory. \nFor example, if you put all the data files in a directory called `shared_data` your manifest would look like: \n```\ndata: ../shared_data\n```\n\nIf you are are using a [standalone project structure](/packaging-workflows#standalone-project) then the data-files are placed in the `data` folder of your project.\n\nIn the sum-numbers example the `stage3.Cat` component references one such data file:\n\n```yaml\n# ... omitted ...\ncomponents:\n# ... omitted ...\n- stage: 3\n  name: Cat\n  command:\n    executable: \"cat\"\n    arguments: \"cat_me.txt\"\n  references:\n    - \"data/cat_me.txt:copy\"\n# ... omitted ...\n```\n\nIn this example the `st4sd-runtime` will copy the file `$INSTANCE_DIR/data/cat_me.txt` into the working directory of the `stage3.Cat` file right before the component executes. \n\nThe `st4sd-runtime` supports replacing files under the `data` folder via the `-d` option of `elaunch.py`. Keep in mind that the argument to `-d` must be the absolute, or relative, path to a file whose name matches one of the files under the `data` folder. If there's no `-d` option to override a `data` file, the `st4sd-runtime` will use the one provided by the workflow package to fulfil the DataReferences to it.\n\n\n### Variables\n\nFinally, the `st4sd-runtime` supports providing a file containing user defined variables via the `-a` commandline argument to the `elaunch.py` script. User variables overwrite global and stage variables but not variables defined by components. The schema of the file is:\n\n```yaml\nglobal: # dictionary of variables which are visible to all components\n  name: some-primitive-value(str, float, int)\nstages:\n  stageIndex(integer): # dictionary of variables visible to components in stageIndex\n    name: some-primitive-value(str, float, int)\n```\n\nUser variables can be used to overwrite the behaviour of components (e.g. arguments or even FlowIR configuration fields). Here is an example user-variables file for this workflow which changes the number of replicas from 3 to just 1:\n\n```yaml\nglobal:\n  numberOfPoints: 1\n```\n\nCurrently, we expect that user variables are stored in a file with the extension `.yaml` OR `.yml`. The [variables section](/workflow-specification#variables) contains more information about variables and variable scopes.\n\n## Key-Outputs\n\n[Key-Outputs](/workflow-specification#key-outputs) are named `DataReferences` that point to important paths which the virtual experiment produced.\n\nIn sum-numbers there is only 1 key-output with the name `TotalSum`. It points to a file `out.stdout` that the `stage2.Sum` component produces.\nThis file contains the sum of all the numbers that this toy virtual experiment calculates.DataReferences\n\nThis is the relevant FlowIR snippet from sum-numbers:\n\n```yaml\noutput:\n  TotalSum:\n    data-in: \"stage2.Sum/out.stdout:copy\"\n```\n\n## Executing `sum-numbers`\n\nThis section assumes that you've already installed [st4sd-runtime-core](/installation#set-up-local-client) locally and cloned `sum-numbers`. If you've installed `st4sd-runtime-core` in a virtual environment take a moment to load it before continuing.\n\nTo execute this workflow use `elaunch.py` (the script should take a couple of minutes to complete).\n\n```bash\nelaunch.py sum-numbers\n```\n\nAn `instance directory` will be created in the directory you execute `elaunch.py`.  The instance directory will have the name `sum-numbers-<TIMESTAMP>.instance` (in the example below: `sum-numbers-2021-03-01T094529.183587`).\n\nEach `sum-numbers` workflow component has its own working directory under the instance directory called: `$INSTANCE_DIR/stages/stage<stage_index:%d>/<component_name>/`.\n\n `elaunch.py` will output text that is similar to the following:\n\n```bash\n$ elaunch.py sum-numbers\nUnable to import pythonlsf - limited LSF functionality will be available\nINFO      MainThread                     root                          : point_logger_to_random_file 2021-03-01 09:45:29,125: Experiment log at /tmp/tmpso2ajxxe\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,126: Using modules in /home/username/projects/st4sd-runtime/python/experiment\nINFO      MainThread                     root                          : CreateHaltClosure    2021-03-01 09:45:29,126: Creating halt closure monitoring /home/shared/CHPCBackend/.halt_backend for pid 888\nINFO      MainThread                     root                          : CreateHaltClosure    2021-03-01 09:45:29,126: Creating halt closure monitoring /home/shared/CHPCBackend/.kill_backend for pid 888\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,126: Deploying Experiment at SumNumbers.package/ \nINFO      MainThread                     FlowIRConf                    : __init__             2021-03-01 09:45:29,127: Load FLOWIR, the default platform is default\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,151: Replicate job stage1.ExtractRow (3) (replicated refs: [])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,151: Replicate job stage1.PartialSum (3) (replicated refs: ['ExtractRow:output'])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,152: Aggregate job stage2.Sum\nINFO      MainThread                     root                          : ValidatePackage      2021-03-01 09:45:29,183: <experiment.conf.FlowIRExperimentConfiguration object at 0x7fc55fe10eb0>\nWARNING   MainThread                     root                          : ValidatePackage      2021-03-01 09:45:29,183: TESTING EXPERIMENT FROM PACKAGE\nINFO      MainThread                     FlowIRConf                    : __init__             2021-03-01 09:45:29,229: Load FLOWIR, the default platform is default\nINFO      MainThread                     data.experiment               : experimentFromPackage 2021-03-01 09:45:29,258: Detected use of virtual env - will link in python bin directory\nINFO      MainThread                     data.experiment               : experimentFromPackage 2021-03-01 09:45:29,259: Created python link /home/username/projects/packages/SumNumbers-2021-03-01T094529.183587.instance/python to /home/username/anaconda2/envs/flow3.8\nWARNING   MainThread                     data.experiment               : __init__             2021-03-01 09:45:29,259: Explicitly instructed to load a package\nINFO      MainThread                     FlowIRConf                    : __init__             2021-03-01 09:45:29,259: Load FLOWIR, the default platform is default\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,317: Replicate job stage1.ExtractRow (3) (replicated refs: [])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,318: Replicate job stage1.PartialSum (3) (replicated refs: ['ExtractRow:output'])\nINFO      MainThread                     flowir                        : apply_replicate      2021-03-01 09:45:29,318: Aggregate job stage2.Sum\nINFO      MainThread                     root                          : ValidatePackage      2021-03-01 09:45:29,355: Created experiment: There are 4 stages. Current stage 0\nINFO      MainThread                     root                          : point_logger_to_logfile 2021-03-01 09:45:29,355: Experiment log at /home/username/projects/packages/SumNumbers-2021-03-01T094529.183587.instance/output/experiment.log\nWARNING   MainThread                     executors.localchecker        : _findExecutablePath  2021-03-01 09:45:29,370: Found pathless executable (cat) - checking if resolvable in command environment\nINFO      MainThread                     executors.localchecker        : _findExecutablePath  2021-03-01 09:45:29,378: Found executable in command environment - using /usr/bin/cat\nDEBUG     MainThread                     output.outputmonitor          : checkDataReferences  2021-03-01 09:45:29,387: Monitoring /home/username/projects/packages/SumNumbers-2021-03-01T094529.183587.instance/stages/stage2/Sum/out.stdout\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,391: Status after deployment:\nINFO      MainThread                     control.controller            : parse_workflow_graph 2021-03-01 09:45:29,417: Updating WorkflowGraph\nINFO      MainThread                     root                          : <module>             2021-03-01 09:45:29,417: Starting Experiment\nINFO      StatusMonitor                  output.statusmonitor          : CheckStatus          2021-03-01 09:45:29,435: No stage running\nINFO      MainThread                     root                          : Run                  2021-03-01 09:45:29,435: Running Stage 0 (stage0) with 1 jobs. Data located at SumNumbers-2021-03-01T094529.183587.instance/stages/stage0\nINFO      MainThread                     control.controller            : initialise           2021-03-01 09:45:29,436: Initial dependency analysis:<Component(s) report>\n  stage0.GenerateInput[pending] inputs: []\n  stage1.ExtractRow1[pending] inputs: [stage0.GenerateInput]\n  stage1.PartialSum1[pending] inputs: [stage1.ExtractRow1]\n  stage1.ExtractRow2[pending] inputs: [stage0.GenerateInput]\n  stage1.PartialSum2[pending] inputs: [stage1.ExtractRow2]\n  stage1.ExtractRow0[pending] inputs: [stage0.GenerateInput]\n  stage1.PartialSum0[pending] inputs: [stage1.ExtractRow0]\n  stage2.Sum[pending] inputs: [stage1.PartialSum0, stage1.PartialSum1, stage1.PartialSum2]\n  stage3.Cat[pending] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     output.outputmonitor          : run                  2021-03-01 09:45:29,437: No output to monitor in stage 0\nINFO      MainThread                     control.controller            : run                  2021-03-01 09:45:29,437: Report for stage 0\n<Component(s) report>\n  stage0.GenerateInput[pending] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:29,438: System appears stable - no new exceptions in last 30 secs\nWARNING   MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:29,439: Waited 0 seconds (max 120)\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:29,439: <Check for promotions>\nREADY stage3.Cat in stage 0\nREADY stage0.GenerateInput in stage 0\n<\\Check for promotions>\n...\nINFO      MainThread                     control.controller            : run                  2021-03-01 09:45:39,513: Stage 0 complete. Total components 1\nINFO_MED  MainThread                     output.outputmonitor          : kill                 2021-03-01 09:45:39,514: Received kill\nINFO_MED  MainThread                     output.outputmonitor          : kill                 2021-03-01 09:45:39,514: Setting cancel copy event: <threading.Event object at 0x7fc55c4adb80>\nINFO      MainThread                     root                          : Run                  2021-03-01 09:45:39,515: Stage 0 complete\nINFO      MainThread                     root                          : Run                  2021-03-01 09:45:39,516: Running Stage 1 (stage1) with 6 jobs. Data located at SumNumbers-2021-03-01T094529.183587.instance/stages/stage1\nINFO      MainThread                     control.controller            : initialise           2021-03-01 09:45:39,526: Initial dependency analysis:<Component(s) report>\n  stage0.GenerateInput[finished] inputs: []\n  stage1.ExtractRow1[pending] inputs: []\n  stage1.PartialSum1[pending] inputs: [stage1.ExtractRow1]\n  stage1.ExtractRow2[pending] inputs: []\n  stage1.PartialSum2[pending] inputs: [stage1.ExtractRow2]\n  stage1.ExtractRow0[pending] inputs: []\n  stage1.PartialSum0[pending] inputs: [stage1.ExtractRow0]\n  stage2.Sum[pending] inputs: [stage1.PartialSum0, stage1.PartialSum1, stage1.PartialSum2]\n  stage3.Cat[finished] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     output.outputmonitor          : run                  2021-03-01 09:45:39,527: No output to monitor in stage 1\nINFO      MainThread                     control.controller            : run                  2021-03-01 09:45:39,532: Report for stage 1\n<Component(s) report>\n  stage1.PartialSum2[pending] inputs: [stage1.ExtractRow2]\n  stage1.ExtractRow0[pending] inputs: []\n  stage1.ExtractRow2[pending] inputs: []\n  stage1.PartialSum0[pending] inputs: [stage1.ExtractRow0]\n  stage1.PartialSum1[pending] inputs: [stage1.ExtractRow1]\n  stage1.ExtractRow1[pending] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:39,544: System appears stable - no new exceptions in last 30 secs\nWARNING   MainThread                     control.controller            : WaitOnStability      2021-03-01 09:45:39,545: Waited 0 seconds (max 120)\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,547: <Check for promotions>\nREADY stage1.ExtractRow0 in stage 1\nREADY stage1.ExtractRow2 in stage 1\nREADY stage1.ExtractRow1 in stage 1\n<\\Check for promotions>\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,547: Staging in component stage1.ExtractRow0\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,566: Staging in component stage1.ExtractRow2\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,574: Staging in component stage1.ExtractRow1\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,586: Submitting component stage1.ExtractRow0\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,588: Submitting component stage1.ExtractRow2\nINFO      MainThread                     control.controller            : finalize_submit_components 2021-03-01 09:45:39,590: Submitting component stage1.ExtractRow1\n...\nINFO      StatusMonitor                  output.statusmonitor          : CheckStatus          2021-03-01 09:46:09,811: <Component(s) report>\n  stage0.GenerateInput[finished] inputs: []\n  stage1.ExtractRow1[finished] inputs: []\n  stage1.PartialSum1[finished] inputs: []\n  stage1.ExtractRow2[finished] inputs: []\n  stage1.PartialSum2[finished] inputs: []\n  stage1.ExtractRow0[finished] inputs: []\n  stage1.PartialSum0[finished] inputs: []\n  stage2.Sum[finished] inputs: []\n  stage3.Cat[finished] inputs: []\n<\\Component(s) report, (*) indicates Subject->Observer dependency, P: a placeholder, C: the latest condition of a DoWhile>\nINFO      MainThread                     root                          : <module>             2021-03-01 09:46:09,811: \tThread-4\nINFO      StatusMonitor                  output.statusmonitor          : CheckStatus          2021-03-01 09:46:09,811: Status of stage3: 1.0000 1.0000 finished (active-stages: {3:1.00})\n...\nINFO      MainThread                     root                          : <module>             2021-03-01 09:46:44,868: Clean-up - Final status was\ncost=0\ncurrent-stage=stage3\nexit-status=Success\nexperiment-state=finished\nstage-progress=1.0\nstage-state=finished\nstages=['stage0', 'stage1', 'stage2', 'stage3']\ntotal-progress=1.0\nupdated=2021-03-01 09:46:44.866733\n...\nINFO      MainThread                     root                          : <module>             2021-03-01 09:46:44,877: Experiment complete\nINFO      ThreadPoolExecutor-13_0        db.status                     : _closeConnection     2021-03-01 09:46:44,885: Connection closed\n```\n\nIf you switch to the `$INSTANCE_DIR/stages` directory and run `ls -lR` you should see the below structure:\n\n```\n$ ls -lR\n.:\ntotal 16\ndrwxrwxr-x. 3 username username 4096 Mar  1 09:45 stage0\ndrwxrwxr-x. 8 username username 4096 Mar  1 09:45 stage1\ndrwxrwxr-x. 3 username username 4096 Mar  1 09:45 stage2\ndrwxrwxr-x. 3 username username 4096 Mar  1 09:45 stage3\n\n./stage0:\ntotal 4\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 GenerateInput\n\n./stage0/GenerateInput:\ntotal 12\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username  13 Mar  1 09:45 output.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username  17 Mar  1 09:45 out.stdout\n\n./stage1:\ntotal 24\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 ExtractRow0\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 ExtractRow1\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 ExtractRow2\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 PartialSum0\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 PartialSum1\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 PartialSum2\n\n./stage1/ExtractRow0:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   4 Mar  1 09:45 out.stdout\n\n./stage1/ExtractRow1:\ntotal 8\n-rw-rw-r--. 1 username username 308 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   4 Mar  1 09:45 out.stdout\n\n./stage1/ExtractRow2:\ntotal 8\n-rw-rw-r--. 1 username username 308 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   5 Mar  1 09:45 out.stdout\n\n./stage1/PartialSum0:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   2 Mar  1 09:45 out.stdout\n\n./stage1/PartialSum1:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   3 Mar  1 09:45 out.stdout\n\n./stage1/PartialSum2:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username   3 Mar  1 09:45 out.stdout\n\n./stage2:\ntotal 4\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:46 Sum\n\n./stage2/Sum:\ntotal 8\n-rw-rw-r--. 1 username username 309 Mar  1 09:46 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:46 out.stderr\n-rw-rw-r--. 1 username username   3 Mar  1 09:46 out.stdout\n\n./stage3:\ntotal 4\ndrwxrwxr-x. 2 username username 4096 Mar  1 09:45 Cat\n\n./stage3/Cat:\ntotal 12\n-rw-rw-r--. 1 username username  34 Mar  1 09:45 cat_me.txt\n-rw-rw-r--. 1 username username 309 Mar  1 09:45 component_performance.csv\n-rw-rw-r--. 1 username username   0 Mar  1 09:45 out.stderr\n-rw-rw-r--. 1 username username  34 Mar  1 09:45 out.stdout\n```\n","fileAbsolutePath":"/home/travis/build/st4sd/overview/src/pages/tutorial.mdx"}}},"staticQueryHashes":["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}